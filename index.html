<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Psyche Panacea - Corporate Training Solutions</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="/images/psypan-logo-transparent.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Include Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#0052cc',
            secondary: '#4da8ff',
            dark: '#1a1a1a',
            light: '#f8f9fa',
            accent: '#f59e0b'
          },
          fontFamily: {
            poppins: ['Poppins', 'sans-serif']
          },
          animation: {
            'marquee': 'marquee 25s linear infinite',
            'fadeIn': 'fadeIn 1s ease-in',
            'slideUp': 'slideUp 0.8s ease-out',
            'fadeZoom': 'fadeZoom 2s infinite'
          },
          keyframes: {
            marquee: {
              '0%': { transform: 'translateX(0)' },
              '100%': { transform: 'translateX(-100%)' }
            },
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' }
            },
            slideUp: {
              '0%': { transform: 'translateY(30px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' }
            },
            fadeZoom: {
              '0%, 100%': { opacity: '0.5', transform: 'scale(0.9)' },
              '50%': { opacity: '1', transform: 'scale(1.1)' }
            }
          }
        }
      }
    }
  </script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans', sans-serif;
      background: linear-gradient(to bottom, #ffffff, #f0f9ff);
      color: #334155;
      overflow-x: hidden;
    }

    .hero-pattern {
      background: radial-gradient(circle, rgba(30, 64, 175, 0.05) 0%, rgba(255, 255, 255, 0) 70%);
    }

    .card-hover {
      transition: all 0.3s ease;
    }

    .card-hover:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .testimonial-card {
      background: linear-gradient(145deg, #ffffff, #f8fafc);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
    }

    .logo-marquee {
      display: flex;
      width: 200%;
      animation: marquee 25s linear infinite;
    }

    .logo-item {
      flex: 0 0 auto;
      margin: 0 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.7;
      transition: opacity 0.3s;
    }

    .logo-item:hover {
      opacity: 1;
    }

    .footer-links a {
      position: relative;
    }

    .footer-links a:after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 1px;
      background: white;
      transition: width 0.3s ease;
    }

    .footer-links a:hover:after {
      width: 100%;
    }

    .animate-on-scroll {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s ease, transform 0.8s ease;
    }

    .animate-on-scroll.active {
      opacity: 1;
      transform: translateY(0);
    }

    .slideshow-container {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    .slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      opacity: 0;
      animation: slideShow 15s infinite;
    }

    .slide:nth-child(1) {
      animation-delay: 0s;
    }

    .slide:nth-child(2) {
      animation-delay: 3s;
    }

    .slide:nth-child(3) {
      animation-delay: 6s;
    }

    .slide:nth-child(4) {
      animation-delay: 9s;
    }

    .slide:nth-child(5) {
      animation-delay: 12s;
    }

    /* Fixed navbar solution */
    header {
      background-color: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 1000;
      padding: 1.2rem 3rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    nav a {
      position: relative;
      transition: color 0.3s ease;
    }

    nav a::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -4px;
      left: 0;
      background-color: #0052cc;
      transition: width 0.3s ease;
    }

    nav a:hover::after {
      width: 100%;
    }

    .active-nav-link {
      color: #0052cc;
      font-weight: 600;
    }

    .active-nav-link::after {
      width: 100%;
    }

    @keyframes slideShow {
      0% {
        opacity: 0;
        transform: scale(1.05);
      }

      10% {
        opacity: 1;
        transform: scale(1);
      }

      20% {
        opacity: 1;
      }

      30% {
        opacity: 0;
      }

      100% {
        opacity: 0;
      }
    }

    @media (max-width: 480px) {
      .chatbot-window {
        max-width: 90vw;
        right: 5px;
      }

      .chatbot-input {
        padding: 0.5rem;
      }

      .chatbot-input input {
        padding: 0.5rem;
      }

      .chatbot-toggle {
        width: 50px;
        height: 50px;
      }

      footer .grid {
        grid-template-columns: 1fr;
      }

      .map-container {
        height: 250px;
      }
    }

    /* Map container */
    .map-container {
      height: 300px;
    }

    /* Mobile menu fixes */
    #mobile-menu {
      position: fixed;
      left: 0;
      right: 0;
      top: 20px;
      background: white;
      z-index: 1000;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      /* Start hidden */
    }

    /* Mobile menu visible */
    #mobile-menu.active {
      display: block;
    }

    /* Mobile menu links */
    #mobile-menu a {
      display: block;
      padding: 12px 20px;
      color: #333;
      text-decoration: none;
      border-bottom: 1px solid #eee;
      transition: background 0.3s;
    }

    #mobile-menu a:hover {
      background-color: #f0f7ff;
    }

    /* Active link in mobile menu */
    #mobile-menu a.active {
      background-color: #e6f2ff;
      color: #0052cc;
    }

    /* 1) Container hides the overflow */
    .logo-slider {
      position: relative;
      overflow: hidden;
    }

    /* 2) Track flexes its children in one row and animates */
    .logo-track {
      display: flex;
      /* make sure the total length is twice the viewport so 50% translation lines up */
      width: max-content;
      animation: scroll-logotrack 20s linear infinite;
    }

    /* 3) Pause on hover */
    .logo-slider:hover .logo-track {
      animation-play-state: paused;
    }

    /* 4) Keyframes: shift left by exactly half of the track (your duplicated set) */
    @keyframes scroll-logotrack {
      from {
        transform: translateX(0);
      }

      to {
        transform: translateX(-50%);
      }
    }

    /* wrap your card so the overflow is clipped during the slide */
    .testimonial-card {
      position: relative;
      overflow: hidden;
    }

    /* slide in from right */
    @keyframes slideInFromRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* slide in from left */
    @keyframes slideInFromLeft {
      from {
        transform: translateX(-100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* utility classes */
    .slide-in-right {
      animation: slideInFromRight 0.5s ease-out both;
    }

    .slide-in-left {
      animation: slideInFromLeft 0.5s ease-out both;
    }

    @keyframes pop {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.2);
      }

      100% {
        transform: scale(1);
      }
    }

    .pop {
      animation: pop 2s ease-in-out;
    }

    /* --- Flip card core --- */
    .flip-card {
      perspective: 1200px;
      -webkit-perspective: 1200px;
      position: relative;
      /* for absolute faces */
      min-height: 240px;
      /* ensures card has height so absolute faces render */
      border-radius: 0.75rem;
      /* matches rounded-xl */
      overflow: visible;
      /* allow shadows */
      transition: transform 0.25s ease, box-shadow 0.25s ease;
    }

    /* Outer hover lift (keeps your original hover lift) */
    .flip-card:hover,
    .flip-card:focus-within {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 16px 40px rgba(2, 6, 23, 0.12);
    }

    .flip-card-inner {
      position: relative;
      height: 100%;
      transform-style: preserve-3d;
      -webkit-transform-style: preserve-3d;
      transition: transform 0.7s cubic-bezier(.2, .8, .2, 1);
      will-change: transform;
    }

    /* flip on hover/focus-within OR when .is-flipped is present (JS toggle) */
    .flip-card:hover .flip-card-inner,
    .flip-card:focus-within .flip-card-inner,
    .flip-card.is-flipped .flip-card-inner {
      transform: rotateY(180deg);
      -webkit-transform: rotateY(180deg);
    }

    /* Faces — use absolute so they overlap; inset:0 fills parent */
    .flip-card-front,
    .flip-card-back {
      position: absolute;
      inset: 0;
      /* top:0; right:0; bottom:0; left:0; */
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      /* we'll align content inside */
      justify-content: center;
      padding: 1.5rem;
      /* matches your p-6 */
      box-sizing: border-box;
      border-radius: 0.75rem;
      background: white;
    }

    /* front stays as-is */
    .flip-card-front {
      transform: rotateY(0deg);
      z-index: 2;
    }

    /* back rotated 180 so it reads correctly after flip */
    .flip-card-back {
      transform: rotateY(180deg);
      -webkit-transform: rotateY(180deg);
    }

    /* small style niceties for back content */
    .card-back-inner {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    /* Keep reduced motion preference in mind */
    @media (prefers-reduced-motion: reduce) {
      .flip-card-inner {
        transition: none !important;
      }

      .flip-card {
        transition: none !important;
      }
    }

    /* Responsive tweak: increase min height on larger screens if needed */
    @media (min-width: 768px) {
      .flip-card {
        min-height: 260px;
      }
    }

    /* Custom styles for the animated carousel */
    .logo-slider {
      --gap: 1rem;
    }

    /* control spacing */
    .logo-track {
      gap: var(--gap);
      will-change: transform;
      transition: transform 600ms cubic-bezier(.22, .9, .35, 1);
      align-items: center;
      display: flex;
      padding: 0 1rem;
    }

    .client-logo {
      flex-shrink: 0;
      width: 10rem;
      /* matches w-40 from Tailwind */
      height: 5rem;
      /* matches h-20 from Tailwind */
      border-radius: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      box-shadow: 0 8px 22px rgba(2, 6, 23, 0.06);
      margin: 0 .5rem;
      /* small horizontal gap (mx-4 ~ 1rem total) */
      transform-origin: center;
      transition: transform 420ms cubic-bezier(.22, .9, .35, 1), opacity 300ms;
    }

    /* Centered item scale + prominence */
    .client-logo.is-center {
      transform: scale(1.12);
      z-index: 5;
      opacity: 1;
    }

    /* Non-centered logos slightly dimmed */
    .client-logo.dimmed {
      opacity: 0.55;
      transform: scale(0.98);
      z-index: 1;
    }

    /* smooth image fit */
    .client-logo img {
      max-height: 3.75rem;
      /* ~max-h-16 */
      max-width: 100%;
      object-fit: contain;
      display: block;
    }

    /* Prevent text selection while dragging or clicking */
    .logo-slider,
    .logo-track,
    .client-logo {
      user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
    }

    /* Small responsive tweak */
    @media (max-width: 640px) {
      .client-logo {
        width: 7.5rem;
        height: 4rem;
      }

      .client-logo img {
        max-height: 3rem;
      }
    }

    .stats-value {
      font-size: 3rem;
      font-weight: bold;
      color: white;
      margin-bottom: 0.5rem;
    }

    .stats-label {
      font-size: 1.5rem;
      font-weight: bold;
      color: rgba(255, 255, 255, 0.9);
    }

    /* small extras — keeps your .stats-value class intact and adds a subtle scale while counting */
    .stats-value {
      will-change: transform, opacity;
      display: inline-block;
    }

    .stats-value.counting {
      transform: scale(1.04);
      transition: transform 1ms ease;
    }


    /* ---------------------------
  Review form — visual design
  --------------------------- */

    /* color tokens (override to match your theme) */
    :root {
      --bg-card: #ffffff;
      --muted: #6b7280;
      --primary: #0ea5a4;
      /* adjust to match .bg-primary */
      --primary-dark: #089090;
      --accent: #06b6d4;
      --success: #16a34a;
      --shadow: 0 10px 30px rgba(2, 6, 23, 0.08);
      --glass: rgba(255, 255, 255, 0.6);
    }

    /* Form card */
    #reviewForm {
      max-width: 720px;
      margin: 0 auto;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.85), rgba(250, 250, 250, 0.82));
      border-radius: 14px;
      padding: 20px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(16, 24, 40, 0.04);
      backdrop-filter: blur(6px);
      transition: transform .22s ease, box-shadow .22s ease;
      will-change: transform;
    }

    /* Lift on hover for pointer devices */
    @media (hover: hover) {
      #reviewForm:hover {
        transform: translateY(-6px);
        box-shadow: 0 22px 60px rgba(2, 6, 23, 0.12);
      }
    }

    /* Form fields layout: keep vertical, but arrange some side-by-side on larger screens */
    #reviewForm>div {
      position: relative;
    }

    /* Labels */
    #reviewForm label {
      display: inline-block;
      font-weight: 600;
      color: #0f172a;
      /* dark */
      margin-bottom: 6px;
      font-size: 13px;
    }

    /* Inputs & textarea base */
    #reviewForm input[type="text"],
    #reviewForm input[type="email"],
    #reviewForm input[type="tel"],
    #reviewForm input[type="url"],
    #reviewForm textarea,
    #reviewForm select,
    #reviewForm input[type="file"] {
      width: 100%;
      background: #fff;
      border: 1px solid rgba(15, 23, 42, 0.06);
      padding: 10px 12px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(2, 6, 23, 0.04) inset;
      font-size: 14px;
      color: #0f172a;
      transition: box-shadow .18s ease, transform .12s ease, border-color .12s ease;
      outline: none;
    }

    /* Focus states */
    #reviewForm input:focus,
    #reviewForm textarea:focus,
    #reviewForm select:focus {
      box-shadow: 0 8px 26px rgba(6, 182, 212, 0.08);
      border-color: rgba(6, 182, 212, 0.28);
      transform: translateY(-1px);
    }

    /* Textarea */
    #reviewForm textarea {
      min-height: 110px;
      resize: vertical;
    }

    /* Two-column grouping for Name + Role + Rating on wider screens */
    @media (min-width: 720px) {
      #reviewForm {
        display: grid;
        grid-template-columns: 1fr 320px;
        gap: 18px 24px;
        align-items: start;
      }

      /* make submit row span across both columns */
      #reviewForm>.full-row {
        grid-column: 1 / -1;
        display: flex;
        justify-content: flex-end;
        gap: 12px;
        align-items: center;
      }
    }

    /* File input — nicer native file button */
    #r-photo-file {
      padding: 8px 10px;
      background: linear-gradient(180deg, #ffffff, #f8fafc);
      border-radius: 10px;
    }

    /* Style the file selector button for modern browsers */
    #r-photo-file::file-selector-button {
      margin-right: 8px;
      border: none;
      background: var(--primary);
      color: #fff;
      padding: 8px 12px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background .15s ease, transform .12s ease;
    }

    #r-photo-file::file-selector-button:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    /* Small preview placeholder (without JS you may still reserve space) */
    #r-photo-preview {
      width: 100%;
      height: 140px;
      border-radius: 10px;
      background: linear-gradient(180deg, #f8fafc, #ffffff);
      border: 1px dashed rgba(15, 23, 42, 0.06);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--muted);
      font-size: 13px;
      overflow: hidden;
    }

    /* Select control (rating) */
    #r-rating {
      width: 130px;
      background: linear-gradient(180deg, #fff, #fbfdff);
      text-align: left;
    }

    /* Buttons row adjustments (mobile fallback) */
    #reviewForm .flex {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    /* Primary submit button */
    #modalSubmit {
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      font-weight: 700;
      box-shadow: 0 10px 28px rgba(6, 182, 212, 0.12);
      cursor: pointer;
      transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
    }

    #modalSubmit:hover {
      transform: translateY(-3px);
      box-shadow: 0 18px 48px rgba(6, 182, 212, 0.16);
    }

    #modalSubmit:active {
      transform: translateY(0);
    }

    /* Secondary cancel button */
    #modalCancel {
      background: transparent;
      border: 1px solid rgba(15, 23, 42, 0.06);
      padding: 8px 14px;
      border-radius: 10px;
      cursor: pointer;
      transition: background .12s ease, transform .12s ease;
    }

    #modalCancel:hover {
      background: #fafafa;
      transform: translateY(-2px);
    }

    /* Success / error message */
    #formMsg {
      font-weight: 600;
      color: var(--success);
      transition: opacity .18s ease, transform .12s ease;
    }

    #formMsg.hidden {
      opacity: 0;
      transform: translateY(-6px);
      pointer-events: none;
    }

    #formMsg.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* Tiny helper: improve label spacing inside grid layout */
    #reviewForm label+input,
    #reviewForm label+textarea,
    #reviewForm label+select,
    #reviewForm label+#r-photo-file {
      margin-top: 6px;
    }

    /* Accessibility: focus-visible ring */
    :focus-visible {
      outline: 3px solid rgba(6, 182, 212, 0.14);
      outline-offset: 2px;
    }

    /* Reduced motion preference */
    @media (prefers-reduced-motion: reduce) {

      #reviewForm,
      #modalSubmit,
      #modalCancel {
        transition: none !important;
        animation: none !important;
      }
    }

    /* Decorative micro-animations for input placeholders */
    #reviewForm input::placeholder,
    #reviewForm textarea::placeholder {
      color: rgba(15, 23, 42, 0.45);
    }

    /* Small screen adjustments — stack everything */
    @media (max-width: 719px) {
      #reviewForm {
        padding: 18px;
        display: block;
      }

      #reviewForm .flex {
        justify-content: space-between;
        align-items: center;
      }

      #modalSubmit,
      #modalCancel {
        padding: 10px 12px;
      }

      #r-rating {
        width: 100%;
        max-width: 220px;
      }

      /* ensure the file input is comfortable */
      #r-photo-file {
        padding: 8px;
      }
    }

    /* Optional: subtle input icon (if you later add) */
    .input-with-icon {
      position: relative;
    }

    .input-with-icon .icon {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
    }

    .input-with-icon input {
      padding-left: 34px;
    }

    /* Mobile responsiveness */
    @media (max-width: 640px) {

      /* Main title */
      #slide-container h1 {
        font-size: 2rem !important;
        /* smaller than 4rem */
        line-height: 2.5rem !important;
      }

      /* Service label text */
      #service-label {
        font-size: 1.25rem !important;
        /* smaller than 2rem */
      }

      /* Buttons */
      #slide-container a {
        font-size: 0.875rem;
        /* smaller text */
        padding: 0.5rem 1rem;
        /* reduce button padding */
      }

      /* Arrow buttons */
      #arrow-up,
      #arrow-down {
        width: 2.5rem;
        /* smaller */
        height: 2.5rem;
        font-size: 0.875rem;
      }
    }


    /* recent updates Container */
    .updates-section {
      background-color: #0052cc;
      height: 100%;
      width: 100%;
    }

    .updates-heading {
      text-align: center;
      margin-bottom: 1rem;
    }

    .updates-heading h2 {
      font-size: 2.2rem;
      font-weight: 700;
      color: #fff;
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      animation: scalePulse 1.5s ease-in-out infinite;
    }

    /* small pulse for heading (optional) */
    @keyframes scalePulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.25);
      }
    }

    /* Carousel area */
    .updates-carousel {
      position: relative;
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      height: 550px;
      overflow: hidden;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(37, 99, 235, 0.12), rgba(30, 58, 138, 0.08));
      display: block;
      padding: 1.5rem;
      box-sizing: border-box;
    }

    /* Nav arrows */
    .carousel-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 40;
      width: 52px;
      height: 52px;
      border-radius: 999px;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(41, 152, 237, 0.95);
      color: white;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
      font-size: 35px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 160ms ease, background 160ms ease;
    }

    .carousel-nav:hover {
      transform: translateY(-50%) scale(1.06);
    }

    .carousel-nav-left {
      left: -10px;
    }

    .carousel-nav-right {
      right: -10px;
    }

    /* Make the whole slide scrollable while keeping its fixed size */
    .update-item {
      /* keep positioning & transitions as before */
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      padding: 2rem;
      display: flex;
      gap: 2rem;
      align-items: center;
      /* allow vertical scrolling of content */
      justify-content: center;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(18, 38, 74, 0.06);
      opacity: 0;
      transform: translateX(100%);
      transition: transform 600ms cubic-bezier(.2, .9, .2, 1), opacity 300ms ease;
      z-index: 10;

      /* NEW: make slide itself scrollable (vertical) */
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      /* smooth scrolling on iOS */
      scrollbar-width: thin;
      /* Firefox */
    }

    /* ensure children can shrink inside flex so vertical scroll works properly */
    .update-left,
    .update-right {
      min-width: 0;
      /* important to prevent overflow due to long content */
    }

    /* optional: nicer scrollbar (webkit browsers) */
    .update-item::-webkit-scrollbar {
      width: 10px;
    }

    .update-item::-webkit-scrollbar-thumb {
      background: rgba(30, 58, 138, 0.18);
      border-radius: 999px;
    }

    .update-item::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.03);
    }

    /* Visible slide */
    .update-item.current {
      opacity: 1;
      transform: translateX(0);
      z-index: 20;
    }

    /* Exit left / Enter right classes */
    .update-item.enter-from-right {
      transform: translateX(100%);
    }

    .update-item.enter-from-left {
      transform: translateX(-100%);
    }

    .update-item.enter-to-center {
      transform: translateX(0);
    }

    .update-item.exit-to-left {
      transform: translateX(-100%);
      opacity: 0;
      z-index: 5;
    }

    .update-item.exit-to-right {
      transform: translateX(100%);
      opacity: 0;
      z-index: 5;
    }

    /* slide inner layout: image + text */
    .update-left {
      flex: 1 1 50%;
    }

    .update-right {
      flex: 1 1 50%;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    /* Content parts (hidden initially) */
    .update-title,
    .update-subtitle,
    .update-content,
    .update-image {
      opacity: 0;
      transform: translateY(12px);
    }

    /* fade-in part animation */
    @keyframes fadeInPart {
      from {
        opacity: 0;
        transform: translateY(12px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in {
      animation: fadeInPart 500ms forwards;
    }

    /* Styling for parts */
    .update-title {
      font-size: 2rem;
      font-weight: 700;
      color: #0f172a;
      margin-bottom: 0.5rem;
    }

    .update-subtitle {
      font-size: 1.15rem;
      color: #374151;
      margin-bottom: 0.75rem;
    }

    .update-content {
      font-size: 1rem;
      color: #4b5563;
      line-height: 1.5;
    }

    .update-image {
      width: 100%;
      height: 360px;
      object-fit: contain;
      /* fits fully in box */
      border-radius: 10px;
      background: #f3f4f6;
    }

    /* Read more button */
    .read-more-btn {
      color: #1e3a8a;
      font-weight: 600;
      cursor: pointer;
      display: inline-block;
      margin-top: 0.5rem;
    }

    .read-more-btn:hover {
      color: #2563eb;
    }

    /* Responsive: stack on small */
    @media (max-width: 768px) {
      .updates-carousel {
        height: 640px;
        padding: 1rem;
      }

      .update-item {
        padding: 1rem;
        flex-direction: column-reverse;
        gap: 1rem;
      }

      .update-left,
      .update-right {
        width: 100%;
        flex-basis: auto;
      }

      .update-image {
        height: 280px;
      }

      .updates-heading h2 {
        font-size: 1.5rem;
      }
    }

    /* ---------- Marquee base styles (single track) ---------- */
    .clients-marquee-section {
      width: 100%;
      background: #ffffff;
      padding: 1rem 0;
      box-sizing: border-box;
    }

    .clients-marquee-wrap {
      --marquee-gap: 1.25rem;
      --logo-height-desktop: 80px;
      --logo-height-mobile: 56px;
      --px-per-second: 120;

      max-width: 1300px;
      margin: 0 auto;
      overflow: hidden;
      position: relative;
      padding: 0 1rem;
    }

    /* SINGLE track that will contain clients + a duplicated set for seamless looping */
    .marquee-track {
      display: inline-flex;
      align-items: center;
      gap: var(--marquee-gap);
      white-space: nowrap;
      will-change: transform;
      animation-name: marquee-scroll;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
      animation-duration: 20s;
      /* fallback; JS will set correct duration */
      animation-play-state: running;
    }

    /* Pause on hover */
    .clients-marquee-wrap:hover .marquee-track {
      animation-play-state: paused;
    }

    /* item */
    .marquee-item {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      flex: 0 0 auto;
      box-sizing: border-box;
    }

    .marquee-item .logo-box {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: var(--logo-height-desktop);
      min-width: calc(var(--logo-height-desktop) * 2);
      padding: 0.3rem 0.75rem;
      box-sizing: border-box;
      border-radius: 6px;
      background: transparent;
    }

    .marquee-item img {
      max-height: 100%;
      max-width: 100%;
      object-fit: contain;
      display: block;
    }

    /* animation: translate left by 50% (we duplicate content inside the same track) */
    @keyframes marquee-scroll {
      from {
        transform: translateX(0);
      }

      to {
        transform: translateX(-50%);
      }
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .clients-marquee-wrap {
        --logo-height-desktop: 64px;
      }

      .marquee-item .logo-box {
        min-width: calc(var(--logo-height-desktop) * 1.8);
      }
    }

    @media (max-width: 640px) {
      .clients-marquee-wrap {
        --logo-height-desktop: var(--logo-height-mobile);
        padding: 0 0.5rem;
      }

      .marquee-item .logo-box {
        min-width: calc(var(--logo-height-mobile) * 1.8);
        padding: 0.2rem 0.5rem;
      }
    }

    /* Slideshow styling */
    .slideshow-container {
      position: absolute;
      inset: 0;
    }

    .slide {
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
      opacity: 0;
      transition: opacity 1s ease-in-out;
    }

    .slide.active {
      opacity: 1;
    }

    /* Fade animation for service text */
    .service-text {
      opacity: 1;
      transition: opacity 0.8s ease-in-out;
    }

    /* Fade animations for whole text block */
    #slide-container.fade-out {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s ease, transform 0.8s ease;
    }

    #slide-container.fade-in {
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.8s ease, transform 0.8s ease;
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header>
    <div class="flex items-center space-x-2">
      <img class="h-12 w-14" src="/images/psypan-logo-transparent.png" alt="Psyche Panacea">
      <div class="text-2xl font-bold text-primary">Psyche Panacea</div>
    </div>
    <nav class="hidden md:flex items-center space-x-6">
      <a href="index.html" class="text-primary font-semibold transition-colors px-2 py-1">Home</a>
      <a href="services.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Services</a>
      <a href="flagship-programs.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Flagship
        Programs</a>
      <a href="events.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Events</a>
      <a href="gallery.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Gallery</a>
      <a href="about-us.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">About Us</a>
      <a href="blogs.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Blogs</a>
      <a href="contact.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Contact</a>
    </nav>

    <!-- Mobile Menu Button -->
    <div class="md:hidden flex items-center">
      <button id="mobile-menu-button" class="text-gray-700 hover:text-primary">
        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </header>

  <!-- Mobile Dropdown Menu -->
  <div id="mobile-menu" class="mt-16 md:hidden bg-white shadow-lg rounded-b-lg hidden">
    <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
      <a href="index.html" class="block px-3 py-2 rounded-md text-base font-medium text-primary bg-blue-50">Home</a>
      <a href="services.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Services</a>
      <a href="flagship-programs.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Flagship
        Programs</a>
      <a href="events.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Events</a>
      <a href="gallery.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Gallery</a>
      <a href="about-us.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">About
        Us</a>
      <a href="blogs.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Blogs</a>
      <a href="contact.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Contact</a>
    </div>
  </div>

  <!-- Hero Section -->
  <section class="pt-32 relative overflow-hidden" style="height: 700px;">
    <!-- Background slideshow container -->
    <div class="absolute inset-0 z-0">
      <!-- Background overlay -->
      <div class="absolute inset-0 bg-black opacity-50 z-10"></div>

      <!-- Slideshow images -->
      <div class="slideshow-container">
        <div class="slide" style="background-image: url('/images/bd1.png');"></div>
        <div class="slide" style="background-image: url('/images/bd2.jpg');"></div>
        <div class="slide" style="background-image: url('/images/bd3.jpg');"></div>
        <div class="slide" style="background-image: url('/images/bd4.jpg');"></div>
        <div class="slide" style="background-image: url('/images/bd5.jpg');"></div>
      </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 md:py-24 relative z-10">
      <div class="flex items-center">

        <!-- ← Arrows -->
        <div class="flex flex-col items-center space-y-4 mr-8">
          <button id="arrow-up"
            class="w-12 h-12 bg-white rounded-full shadow flex items-center justify-center transform transition duration-200 hover:scale-110 hover:bg-secondary">
            ▲
          </button>
          <button id="arrow-down"
            class="w-12 h-12 bg-white rounded-full shadow flex items-center justify-center transform transition duration-200 hover:scale-110 hover:bg-secondary">
            ▼
          </button>
        </div>

        <!-- → Text & CTAs -->
        <div class="overflow-hidden">
          <div id="slide-container" class="space-y-12 transform transition-all duration-700 ease-in-out opacity-100">

            <!-- Title + bar -->
            <div class="flex items-center space-x-4">
              <h1 class="text-4xl md:text-5xl font-bold text-white leading-tight" style="font-size: 4rem;">
                Welcome To<br>
                <span class="text-white">Psyche Panacea</span>
              </h1>
            </div>

            <!-- Dynamic service line -->
            <div id="service-label" class="service-text text-xl text-white font-medium"
              style="font-size: 2rem; font-weight: 400;">
              Management Training
            </div>

            <!-- CTAs -->
            <div class="flex flex-wrap gap-4">
              <a href="#contact"
                class="bg-primary hover:bg-secondary text-white px-6 py-3 rounded-lg font-medium transition duration-300">
                Call Us
              </a>
              <a href="#services"
                class="bg-white text-primary border-2 border-primary hover:bg-gray-400 px-6 py-3 rounded-lg font-medium transition duration-300">
                Know More
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Stats Section -->
  <section class="bg-primary py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
        <div class="animate-on-scroll">
          <div id="clients-stat" class="stats-value">350</div>
          <div class="stats-label">Satisfied Clients</div>
        </div>
        <div class="animate-on-scroll">
          <div id="experience-stat" class="stats-value">24+</div>
          <div class="stats-label">Years of Experience</div>
        </div>
        <div class="animate-on-scroll">
          <div id="retention-stat" class="stats-value">98%</div>
          <div class="stats-label">Training Associates</div>
        </div>
        <div class="animate-on-scroll">
          <div id="trained-stat" class="stats-value">5000+</div>
          <div class="stats-label">Participants Trained</div>
        </div>
      </div>
    </div>
  </section>

  <!-- UPDATES SECTION (drop-in) -->
  <section class="updates-section py-12">
    <div class="updates-heading">
      <h2 id="updates-title">Latest Updates</h2>
    </div>

    <div id="updates-carousel" class="updates-carousel" aria-live="polite">
      <!-- arrows -->
      <button id="prevBtn" class="carousel-nav carousel-nav-left" aria-label="Previous update">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="arrow-icon">
          <path d="M15 19l-7-7 7-7" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </button>

      <button id="nextBtn" class="carousel-nav carousel-nav-right" aria-label="Next update">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="arrow-icon">
          <path d="M9 5l7 7-7 7" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </button>
      <!-- slides will be injected here by JS -->
    </div>
  </section>


  <!-- About Section -->
  <section id="about" class="py-16 bg-light">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <h2 class="text-3xl font-bold text-dark mb-4 animate-on-scroll">About Psyche Panacea</h2>
        <div class="w-20 h-1 bg-primary mx-auto mb-6"></div>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto animate-on-scroll">
          Pioneers in Corporate Training Solutions
        </p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
        <div class="animate-on-scroll">
          <div class=" w-full h-96"><img class="object-contain w-full h-full" src="/images/psypan-logo-transparent.png"
              alt=""></div>
        </div>
        <div class="animate-on-scroll">
          <p class="text-lg text-gray-700 mb-6">
            Psyche Panacea has been at the forefront of corporate training and HR consulting since 2001. With over 350
            satisfied clients, we bring innovative methodologies and transformative experiences to organizations across
            India.
          </p>
          <p class="text-lg text-gray-700 mb-8">
            Our unique approach combines psychological insights with practical business applications, creating programs
            that deliver measurable ROI and lasting impact.
          </p>
          <ul class="space-y-4 mb-8">
            <li class="flex items-start">
              <div class="flex-shrink-0 mt-1">
                <div class="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center">
                  <i class="fas fa-check text-white text-xs"></i>
                </div>
              </div>
              <p class="ml-3 text-lg text-gray-700">Proven methodologies with measurable results</p>
            </li>
            <li class="flex items-start">
              <div class="flex-shrink-0 mt-1">
                <div class="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center">
                  <i class="fas fa-check text-white text-xs"></i>
                </div>
              </div>
              <p class="ml-3 text-lg text-gray-700">Customized solutions for diverse industries</p>
            </li>
            <li class="flex items-start">
              <div class="flex-shrink-0 mt-1">
                <div class="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center">
                  <i class="fas fa-check text-white text-xs"></i>
                </div>
              </div>
              <p class="ml-3 text-lg text-gray-700">Expert trainers with industry experience</p>
            </li>
          </ul>
          <a href="contact.html"
            class="inline-block bg-primary hover:bg-secondary text-white px-6 py-3 rounded-lg font-medium transition duration-300">
            Connect With Us
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Services Section — Flip-on-hover cards (copy-paste) -->
  <section id="services" class="py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <h2 class="text-3xl font-bold text-dark mb-4">Our Services</h2>
        <div class="w-20 h-1 bg-primary mx-auto mb-6"></div>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          Innovative training solutions that drive measurable results
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <!-- Card 1: Management Trainings -->
        <article class="flip-card bg-white rounded-xl shadow-lg animate-on-scroll" tabindex="0" role="button"
          aria-pressed="false">
          <div class="flip-card-inner">
            <!-- FRONT: icon + label -->
            <div class="flip-card-front">
              <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-blue-100 rounded-lg flex items-center justify-center">
                  <i class="fas fa-chalkboard-teacher text-primary text-2xl" aria-hidden="true"></i>
                </div>
                <div>
                  <h3 class="text-xl font-bold text-dark mb-0">Management Trainings</h3>
                  <p class="text-sm text-gray-500 mt-1">Leadership, decision-making & strategy</p>
                </div>
              </div>
            </div>

            <!-- BACK: details -->
            <div class="flip-card-back">
              <div class="card-back-inner">
                <h4 class="text-lg font-semibold text-dark">Management Trainings</h4>
                <p class="text-gray-600">
                  Practical programs for new and seasoned managers that focus on people management, strategic thinking,
                  performance coaching and measurable leadership outcomes to drive business results.
                </p>
                <div class="mt-2">
                  <a href="services.html#management"
                    class="inline-block px-4 py-2 rounded-md border border-primary text-primary hover:bg-primary hover:text-white transition">Explore
                    program</a>
                </div>
              </div>
            </div>
          </div>
        </article>

        <!-- Card 2: Employee Engagements Trainings -->
        <article class="flip-card bg-white rounded-xl shadow-lg animate-on-scroll" tabindex="0" role="button"
          aria-pressed="false">
          <div class="flip-card-inner">
            <!-- FRONT -->
            <div class="flip-card-front">
              <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-green-100 rounded-lg flex items-center justify-center">
                  <i class="fas fa-users text-primary text-2xl" aria-hidden="true"></i>
                </div>
                <div>
                  <h3 class="text-xl font-bold text-dark mb-0">Employee Engagements Trainings</h3>
                  <p class="text-sm text-gray-500 mt-1">Boost morale, retention & collaboration</p>
                </div>
              </div>
            </div>

            <!-- BACK -->
            <div class="flip-card-back">
              <div class="card-back-inner">
                <h4 class="text-lg font-semibold text-dark">Employee Engagements Trainings</h4>
                <p class="text-gray-600">
                  Interactive interventions and workshops that strengthen team cohesion, increase engagement scores and
                  build practices that improve employee experience and retention.
                </p>
                <div class="mt-2">
                  <a href="services.html#employee-engagement"
                    class="inline-block px-4 py-2 rounded-md border border-primary text-primary hover:bg-primary hover:text-white transition">Request
                    a session</a>
                </div>
              </div>
            </div>
          </div>
        </article>

        <!-- Card 3: HR Consulting Premium -->
        <article class="flip-card bg-white rounded-xl shadow-lg animate-on-scroll" tabindex="0" role="button"
          aria-pressed="false">
          <div class="flip-card-inner">
            <!-- FRONT -->
            <div class="flip-card-front">
              <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-yellow-100 rounded-lg flex items-center justify-center">
                  <i class="fas fa-briefcase text-primary text-2xl" aria-hidden="true"></i>
                </div>
                <div>
                  <h3 class="text-xl font-bold text-dark mb-0">HR Consulting Premium</h3>
                  <p class="text-sm text-gray-500 mt-1">Policies, org design & strategic HR</p>
                </div>
              </div>
            </div>

            <!-- BACK -->
            <div class="flip-card-back">
              <div class="card-back-inner">
                <h4 class="text-lg font-semibold text-dark">HR Consulting Premium</h4>
                <p class="text-gray-600">
                  End-to-end HR advisory — from capability frameworks and compensation design to talent strategy and
                  change
                  programs that align HR operations with business goals.
                </p>
                <div class="mt-2">
                  <a href="services.html#hr-premium"
                    class="inline-block px-4 py-2 rounded-md border border-primary text-primary hover:bg-primary hover:text-white transition">Get
                    consultancy</a>
                </div>
              </div>
            </div>
          </div>
        </article>

        <!-- Card 4: Employee Assistance Program -->
        <article class="flip-card bg-white rounded-xl shadow-lg animate-on-scroll" tabindex="0" role="button"
          aria-pressed="false">
          <div class="flip-card-inner">
            <!-- FRONT -->
            <div class="flip-card-front">
              <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-indigo-100 rounded-lg flex items-center justify-center">
                  <i class="fas fa-hands-helping text-primary text-2xl" aria-hidden="true"></i>
                </div>
                <div>
                  <h3 class="text-xl font-bold text-dark mb-0">Employee Assistance Program</h3>
                  <p class="text-sm text-gray-500 mt-1">Wellbeing, support & crisis management</p>
                </div>
              </div>
            </div>

            <!-- BACK -->
            <div class="flip-card-back">
              <div class="card-back-inner">
                <h4 class="text-lg font-semibold text-dark">Employee Assistance Program</h4>
                <p class="text-gray-600">
                  Confidential support services, counseling linkages and manager toolkits to help employees through
                  personal
                  or professional challenges while protecting business continuity.
                </p>
                <div class="mt-2">
                  <a href="services.html#assistance"
                    class="inline-block px-4 py-2 rounded-md border border-primary text-primary hover:bg-primary hover:text-white transition">Contact
                    us</a>
                </div>
              </div>
            </div>
          </div>
        </article>

        <!-- Card 5: Outbound Trainings/Offsites -->
        <article class="flip-card bg-white rounded-xl shadow-lg animate-on-scroll" tabindex="0" role="button"
          aria-pressed="false">
          <div class="flip-card-inner">
            <!-- FRONT -->
            <div class="flip-card-front">
              <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-purple-100 rounded-lg flex items-center justify-center">
                  <i class="fas fa-hiking text-primary text-2xl" aria-hidden="true"></i>
                </div>
                <div>
                  <h3 class="text-xl font-bold text-dark mb-0">Outbound Trainings/Offsites</h3>
                  <p class="text-sm text-gray-500 mt-1">Experiential learning & team bonding</p>
                </div>
              </div>
            </div>

            <!-- BACK -->
            <div class="flip-card-back">
              <div class="card-back-inner">
                <h4 class="text-lg font-semibold text-dark">Outbound Trainings/Offsites</h4>
                <p class="text-gray-600">
                  Adventure-based and facilitation-led offsites that convert shared experiences into improved
                  collaboration,
                  trust and practical team rituals to carry back to the workplace.
                </p>
                <div class="mt-2">
                  <a href="services.html#outbound"
                    class="inline-block px-4 py-2 rounded-md border border-primary text-primary hover:bg-primary hover:text-white transition">Request
                    quote</a>
                </div>
              </div>
            </div>
          </div>
        </article>

        <!-- Card 6: Soft Skills -->
        <article class="flip-card bg-white rounded-xl shadow-lg animate-on-scroll" tabindex="0" role="button"
          aria-pressed="false">
          <div class="flip-card-inner">
            <!-- FRONT -->
            <div class="flip-card-front">
              <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-pink-100 rounded-lg flex items-center justify-center">
                  <i class="fas fa-comments text-primary text-2xl" aria-hidden="true"></i>
                </div>
                <div>
                  <h3 class="text-xl font-bold text-dark mb-0">Soft Skills</h3>
                  <p class="text-sm text-gray-500 mt-1">Communication, influence & emotional intelligence</p>
                </div>
              </div>
            </div>

            <!-- BACK -->
            <div class="flip-card-back">
              <div class="card-back-inner">
                <h4 class="text-lg font-semibold text-dark">Soft Skills</h4>
                <p class="text-gray-600">
                  Practical modules focusing on communication, presentation, stakeholder management and EI — designed to
                  improve day-to-day effectiveness and leadership presence.
                </p>
                <div class="mt-2">
                  <a href="services.html#soft-skills"
                    class="inline-block px-4 py-2 rounded-md border border-primary text-primary hover:bg-primary hover:text-white transition">Learn
                    more</a>
                </div>
              </div>
            </div>
          </div>
        </article>
      </div>

    </div>
  </section>

  <!-- Testimonials Section -->
  <section id="testimonials" class="py-16 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold text-dark mb-4 animate-on-scroll">What Our Clients Say</h2>
        <div class="w-20 h-1 bg-primary mx-auto mb-6"></div>
        <p class="text-gray-600 max-w-2xl mx-auto">Real feedback from organisations and participants who attended
          our
          programs.</p>
      </div>

      <!-- Main testimonial display card -->
      <div class="max-w-3xl mx-auto bg-white rounded-2xl p-8 shadow-lg relative">
        <!-- Add Review button -->
        <div class="absolute top-6 right-6">
          <button id="addReviewBtn" class="px-4 py-2 bg-primary text-white rounded-lg shadow hover:opacity-95">
            + Add Review
          </button>
        </div>

        <div class="flex items-center mb-6">
          <img id="testimonial-photo" src="" alt="Client photo"
            class="w-20 h-20 rounded-full object-cover border-2 border-indigo-50 shadow-sm" />
          <div class="ml-4">
            <div id="testimonial-name" class="font-bold text-xl">Name Here</div>
            <div id="testimonial-role" class="text-primary text-sm">Role • Company</div>
          </div>
        </div>

        <p id="testimonial-text" class="text-gray-700 text-lg italic mb-6">
          “Testimonial text goes here.”
        </p>

        <div id="testimonial-stars" class="flex items-center mb-6"></div>

        <div class="flex items-center justify-between">
          <div>
            <button id="prev-btn" class="px-3 py-2 rounded-md border border-gray-200 hover:bg-slate-50 text-sm">
              ← Prev
            </button>
            <button id="next-btn" class="ml-3 px-3 py-2 rounded-md border border-gray-200 hover:bg-slate-50 text-sm">
              Next →
            </button>
          </div>

          <div id="testimonial-counter" class="text-sm text-gray-500">0 of 0</div>
        </div>
      </div>

      <!-- Live grid of recent testimonials -->
      <div class="mt-10 max-w-7xl mx-auto">
        <h3 class="text-lg font-semibold mb-4">Recent Reviews</h3>
        <div id="testimonials-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      </div>
    </div>

    <!-- Add Review Modal -->
    <div id="reviewModal" style="z-index: 1000;"
      class="fixed inset-0 z-50 hidden items-center justify-center bg-black/40 p-4">
      <div class="bg-white rounded-xl w-full max-w-xl p-6 shadow-lg relative">
        <button id="modalClose" class="absolute top-4 right-4 text-gray-500 text-2xl">×</button>
        <h4 class="text-xl font-bold mb-3">Add a Review</h4>

        <form id="reviewForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700">Full name</label>
            <input id="r-name" required class="mt-1 block w-full border border-gray-200 rounded-md p-2"
              placeholder="e.g. Priya Sharma" />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700">Role / Company</label>
            <input id="r-role" class="mt-1 block w-full border border-gray-200 rounded-md p-2"
              placeholder="e.g. HR Manager • ACME Corp" />
          </div>



          <!-- NEW: File upload input for Cloudinary -->
          <div>
            <label class="block text-sm font-medium text-gray-700">Upload Your Photo (optional)</label>
            <input id="r-photo-file" type="file" accept="image/*" class="mt-1 block w-full" />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700">Rating</label>
            <select id="r-rating" required class="mt-1 block w-36 border border-gray-200 rounded-md p-2">
              <option value="5">5 — Excellent</option>
              <option value="4">4 — Very Good</option>
              <option value="3">3 — Good</option>
              <option value="2">2 — Fair</option>
              <option value="1">1 — Poor</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700">Review</label>
            <textarea id="r-text" rows="4" required class="mt-1 block w-full border border-gray-200 rounded-md p-2"
              placeholder="Write your experience..."></textarea>
          </div>

          <div class="flex justify-end gap-3">
            <button type="button" id="modalCancel" class="px-4 py-2 rounded-md border border-gray-200">Cancel</button>
            <button type="submit" id="modalSubmit" class="px-4 py-2 bg-primary text-white rounded-md">Submit
              Review</button>
          </div>

          <div id="formMsg" class="text-sm text-green-600 mt-2 hidden"></div>
        </form>
      </div>
    </div>
  </section>

  <!-- Cloudinary CDN (declaration) -->
  <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>

  <!-- CLIENT LOGO MARQUEE (single-row, no double-vertical logos) -->
  <section id="clients-marquee" class="clients-marquee-section" aria-label="Our clients">
    <div class="clients-marquee-wrap">
      <div class="marquee-track" aria-hidden="true"></div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
        <!-- Left half: Map -->
        <div class="w-full map-container rounded-xl overflow-hidden border-2 border-blue-700 shadow-lg">
          <iframe src="https://maps.google.com/maps?q=28.467519771527627,77.03697016794533&z=15&output=embed"
            width="100%" height="100%" frameborder="0" style="border:0;" allowfullscreen loading="lazy"
            class="filter grayscale hover:grayscale-0 transition-all duration-500 pointer-events-auto"
            gestureHandling="greedy">
          </iframe>
        </div>

        <!-- Right half: Content -->
        <div class="grid grid-cols-1 gap-8">
          <!-- Company Info -->
          <div>
            <div class="flex items-center mb-4">
              <div class="bg-gradient-to-r from-blue-600 to-blue-800 p-2 rounded-lg mr-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
              </div>
              <h3 class="text-xl font-bold text-blue-400">Psyche Panacea</h3>
            </div>
            <p class="text-gray-400">
              Pioneers of innovative and breakthrough methodologies in the Indian consultation arena,
              transforming organizations through strategic HR solutions.
            </p>
          </div>

          <!-- Contact Info -->
          <div>
            <h4 class="text-lg font-semibold mb-3 text-blue-400 border-b border-blue-700 pb-1">Contact Us
            </h4>
            <ul class="space-y-4 text-gray-400 text-sm">
              <li class="flex items-start">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 mt-1 text-blue-500" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <span>308/2, Old Delhi Rd, adjacent Country Inn,<br>Sector 12 A, Anamika
                  Enclave,<br>Sector 14, Gurugram, Haryana 122001</span>
              </li>
              <li class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-500" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                </svg>
                <span>09810323292, 09810319292</span>
              </li>
              <li class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-500" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
                <span>hr@psypanconsulting.com</span>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Footer Bottom -->
      <div class="border-t border-gray-800 mt-12 pt-6 text-center text-gray-500 text-sm">
        <p>© 2023 Psyche Panacea. All rights reserved. Designed by Psyche Panacea Team.</p>
      </div>
    </div>
  </footer>

  <!-- ====== Chatbot (copy-paste into your HTML) ====== -->
  <div class="chatbot fixed bottom-6 right-4 z-50" style="z-index: 999;">
    <!-- Toggle / Floating Button -->
    <button id="chatbotToggle"
      class="chatbot-toggle w-14 h-14 sm:w-16 sm:h-16 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center cursor-pointer shadow-lg text-white"
      aria-label="Open chat">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        class="opacity-95">
        <path
          d="M21 11.5a8.38 8.38 0 0 1-12.5 7.5 8.38 8.38 0 0 1-7.5-12.5 8.38 8.38 0 0 1 12.5-7.5 8.38 8.38 0 0 1 7.5 12.5z" />
        <path d="M9 9h6v6H9z" />
      </svg>
    </button>

    <!-- Chat window -->
    <div id="chatbotWindow"
      class="chatbot-window w-80 sm:w-96 max-h-[540px] absolute bottom-20 sm:bottom-24 right-0 bg-white rounded-xl shadow-2xl hidden border border-blue-100 flex flex-col overflow-hidden">
      <!-- Header -->
      <div
        class="chatbot-header bg-gradient-to-r from-primary to-blue-600 text-white p-3 sm:p-4 rounded-t-xl flex justify-between items-center">
        <div>
          <div class="font-bold text-sm sm:text-base">Psyche Panacea Assistant</div>
          <div class="text-xs opacity-90">Corporate Training & HR Support</div>
        </div>
        <div class="flex items-center gap-2">
          <button id="chatClear" title="Clear chat"
            class="text-xs bg-white/10 px-2 py-1 rounded-md hover:bg-white/20">Clear</button>
          <button id="chatbotClose" class="chatbot-close text-2xl leading-none">×</button>
        </div>
      </div>

      <!-- Body -->
      <div id="chatbotBody" class="chatbot-body p-3 sm:p-4 overflow-y-auto flex-1 space-y-3 bg-white">
        <div
          class="chatbot-message bot bg-blue-50 text-gray-800 rounded-lg p-2 sm:p-3 mb-1 max-w-[86%] float-left clear-both text-sm sm:text-base">
          Welcome! Choose an option below or type your question. 👇
        </div>

        <!-- quick options container -->
        <div id="chatOptions" class="w-full flex flex-wrap gap-2"></div>
      </div>

      <!-- Input area -->
      <div class="chatbot-input p-2 sm:p-3 border-t border-gray-200 flex gap-2 items-center">
        <input id="chatbotInput" type="text"
          class="flex-1 p-2 sm:p-3 border border-gray-300 rounded-lg text-sm sm:text-base focus:outline-none"
          placeholder="Ask about our programs or click an option...">
        <button id="chatbotSend"
          class="bg-primary text-white px-3 sm:px-4 py-2 sm:py-3 rounded-lg font-semibold text-sm sm:text-base">Send</button>
      </div>
    </div>
  </div>

  <!-- ====== Chatbot script (place before </body>) ====== -->
  <script>

    const slides = document.querySelectorAll(".slide");
    const slideContainer = document.getElementById("slide-container");
    const serviceLabel = document.getElementById("service-label");

    // Services linked with slides
    const services = [
      "Management Training",
      "Employee Engagement Programs",
      "HR Consulting",
      "Employee Assistance Programs",
      "Outbound Trainings/Offsite",
      "Soft Skills Training"
    ];

    let currentIndex = 0;
    let slideInterval;

    function updateContent(index) {
      // Fade out the entire block
      slideContainer.classList.add("fade-out");

      setTimeout(() => {
        // Update service text
        serviceLabel.textContent = services[index];

        // Fade in the entire block
        slideContainer.classList.remove("fade-out");
        slideContainer.classList.add("fade-in");

        setTimeout(() => {
          slideContainer.classList.remove("fade-in"); // cleanup
        }, 800);
      }, 800); // wait for fade-out
    }

    function showSlide(index) {
      slides.forEach((slide, i) => {
        slide.classList.toggle("active", i === index);
      });
      updateContent(index);
    }

    function nextSlide() {
      currentIndex = (currentIndex + 1) % slides.length;
      showSlide(currentIndex);
    }

    function prevSlide() {
      currentIndex = (currentIndex - 1 + slides.length) % slides.length;
      showSlide(currentIndex);
    }

    function startSlideshow() {
      slideInterval = setInterval(nextSlide, 3000);
    }

    function stopSlideshow() {
      clearInterval(slideInterval);
    }

    // Arrow navigation
    document.getElementById("arrow-up").addEventListener("click", () => {
      stopSlideshow();
      prevSlide();
      startSlideshow();
    });

    document.getElementById("arrow-down").addEventListener("click", () => {
      stopSlideshow();
      nextSlide();
      startSlideshow();
    });

    // Init
    showSlide(currentIndex);
    startSlideshow();

    /* Use your clients array exactly as provided */
    const clients = [
      // Automotive
      { name: "Honda", image: "honda.png", category: "automotive", tagline: "The Power of Dreams" },
      { name: "Maruti Suzuki", image: "maruti.png", category: "automotive", tagline: "Way of Life" },
      { name: "Hero", image: "hero.png", category: "automotive", tagline: "Desh Ki Dhadkan" },
      { name: "JCB", image: "jcb.png", category: "automotive", tagline: "Powering Progress" },
      { name: "Yamaha", image: "BirlaYamaha.png", category: "automotive", tagline: "Revs Your Heart" },
      { name: "Suzuki Motorcycles", image: "Suzuki-Motorcycles.png", category: "automotive" },
      { name: "JK Tyres", image: "jktyre.png", category: "automotive" },
      { name: "Escort", image: "Escort.png", category: "automotive" },
      { name: "Sona Koyo", image: "Sona-Koyo.jpg", category: "automotive" },
      { name: "Minda", image: "minda.png", category: "automotive" },
      { name: "JBM Group", image: "jbm.png", category: "automotive" },

      // Manufacturing
      { name: "ACC", image: "acc.png", category: "manufacturing", tagline: "The Professional's Choice" },
      { name: "Amtek", image: "Amtek.jpg", category: "manufacturing" },
      { name: "Anchor", image: "Anchor.jpg", category: "manufacturing" },
      { name: "Asahi Glass", image: "Asahi-Glass.png", category: "manufacturing" },
      { name: "ATO", image: "ato.png", category: "manufacturing" },
      { name: "BIRLA POWER", image: "birla-power.png", category: "manufacturing", tagline: "POWER... the ability to change" },
      { name: "Bria", image: "Birla.jpg", category: "manufacturing" },
      { name: "Chemsys", image: "Chemsys.png", category: "manufacturing" },
      { name: "Colgate and Palmolive", image: "ColgateandPalmolive.png", category: "manufacturing" },
      { name: "Daikin", image: "Daikin.png", category: "manufacturing" },
      { name: "Dabur", image: "dabur.png", category: "manufacturing" },
      { name: "Ester Industries", image: "Ester-Industries.png", category: "manufacturing" },
      { name: "Grasim", image: "Grasim.jpg", category: "manufacturing" },
      { name: "Hindustan Zinc", image: "Hindustan-Zinc.png", category: "manufacturing" },
      { name: "Indian Oil", image: "indian-oil.png", category: "manufacturing" },
      { name: "NTPC", image: "ntpc.png", category: "manufacturing" },
      { name: "Shree Cements", image: "Shree-Cements.jpg", category: "manufacturing" },
      { name: "SRF", image: "SRF.png", category: "manufacturing" },

      // Technology
      { name: "Bharti", image: "Bharti.png", category: "technology" },
      { name: "HCL", image: "hcl.png", category: "technology" },
      { name: "Hughes Software", image: "Hughes-Software.png", category: "technology" },
      { name: "ICICI Bank", image: "icici-bank.png", category: "technology" },
      { name: "Mizuho Bank", image: "Mizuho-Bank.png", category: "technology" },
      { name: "RMSI", image: "RMSI.png", category: "technology" },
      { name: "Safran", image: "Safran.png", category: "technology" },
      { name: "SPIL", image: "SPIL.png", category: "technology" },
      { name: "Tech Mahindra", image: "tech-mahindra.png", category: "technology" },
      { name: "TMTL", image: "TMTL.png", category: "technology" },
      { name: "Wabag", image: "Wabag.png", category: "technology" },
      { name: "OMAX Technology", image: "LOGO_OMAX-technology.png", category: "technology" },
      { name: "Nex-Gen", image: "Nex-Gen.png", category: "technology" },
      { name: "Biotech", image: "Biotech.webp", category: "technology" },

      // FMCG
      { name: "Pepsi", image: "pepsi.png", category: "fmg" },
      { name: "Parle-G", image: "Parle-G.jpg", category: "fmg" },
      { name: "Dabur", image: "DABUR (1).png", category: "fmg" },
      { name: "Colgate and Palmolive", image: "Colgate-and-Palmoliv.png", category: "fmg" },
      { name: "Whirlpool", image: "whirl-pool.png", category: "fmg" },
      { name: "Spencer's", image: "spencers.png", category: "fmg" },
      { name: "Van Melle", image: "Van-Melle.png", category: "fmg" },
      { name: "Mother Dairy", image: "Mother-Dairy.jpg", category: "fmg" },
      { name: "BSES", image: "bses.png", category: "fmg" },
      { name: "Antheme", image: "Antheme.png", category: "fmg" },
      { name: "BPT", image: "BPT.png", category: "fmg" },
      { name: "EIL", image: "eil.png", category: "fmg" },
      { name: "LBL", image: "lbl.png", category: "fmg" },
      { name: "UD-Trucks", image: "UD-trucks-logo-637x426.jpg", category: "fmg" },
      { name: "UNO MINDA", image: "UNO MINDA.png", category: "fmg" },
      { name: "Vecv", image: "Vecv.png", category: "fmg" },
    ];

    const COMMON_PATH = 'images/clients/'; // common path requested
    const DEFAULT_PLACEHOLDER = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=='; // tiny transparent pixel

    function createItemNode(client) {
      const item = document.createElement('div');
      item.className = 'marquee-item';
      const box = document.createElement('div');
      box.className = 'logo-box';

      const img = document.createElement('img');
      img.alt = client.name || '';
      img.src = COMMON_PATH + client.image;
      img.onerror = function () {
        this.onerror = null;
        // try a safe placeholder in images/clients/ first (if you have it), else use transparent pixel
        this.src = COMMON_PATH + 'placeholder.png';
        // if placeholder.png doesn't exist on server, the browser will try that and hit onerror again
        // but we already removed onerror to avoid infinite loop; in that case you will see broken image or provide placeholder.png
      };

      box.appendChild(img);
      item.appendChild(box);
      return item;
    }

    function populateSingleTrack() {
      const track = document.querySelector('.marquee-track');
      if (!track) return;
      track.innerHTML = '';

      // create fragment of original items
      const frag = document.createDocumentFragment();
      clients.forEach(c => frag.appendChild(createItemNode(c)));

      // append original items
      track.appendChild(frag);

      // append a clone of the same items to the same track (seamless loop)
      // we clone nodes to avoid reusing the exact same elements (keeps DOM stable)
      const nodesToClone = Array.from(track.children).slice(0, clients.length);
      nodesToClone.forEach(n => track.appendChild(n.cloneNode(true)));
    }

    function adjustDurationSingleTrack() {
      const wrap = document.querySelector('.clients-marquee-wrap');
      const track = document.querySelector('.marquee-track');
      if (!wrap || !track) return;

      // One set width is half the scrollWidth because we duplicated content inside same track
      const total = track.scrollWidth;
      const oneSetWidth = total / 2 || track.getBoundingClientRect().width / 2;

      const style = getComputedStyle(wrap);
      const pxPerSecond = Math.max(40, parseFloat(style.getPropertyValue('--px-per-second')) || 120);

      // duration so that oneSetWidth travels at pxPerSecond speed (seconds)
      const duration = Math.max(6, (oneSetWidth / pxPerSecond));
      track.style.animationDuration = duration + 's';
    }

    // init
    function initSingleMarquee() {
      populateSingleTrack();

      // wait a bit for images to load and layout to settle before measuring
      setTimeout(() => {
        adjustDurationSingleTrack();
      }, 80);

      // recalc on resize (debounced)
      let t;
      window.addEventListener('resize', () => {
        clearTimeout(t);
        t = setTimeout(adjustDurationSingleTrack, 150);
      });
    }

    document.addEventListener('DOMContentLoaded', initSingleMarquee);

    (function () {
      // --- configuration / content (edit as needed) ---
      const contactInfo = {
        address: '08/2, Old Delhi Rd, adjacent Country In, Sector 12 A, Anamika Enclave,Sector 14, Gurugram, Haryana 122001',
        phones: ['+91 9810319292', '+91 9810323292'],
        email: 'hr@psypanconsulting.com',
      };

      // PAGE URL map: clicking goto/learn-more opens these pages in the same tab
      const pageUrlMap = {
        'Services': 'services.html',
        'Flagship Programs': 'flagship-programs.html',
        'Blogs': 'blogs.html',
        'Events': 'events.html',
        'Contact': 'contact.html',
        'About Us': 'about-us.html',
        // keep Gallery as optional (if desired, add a page)
        'Gallery': 'gallery.html'
      };

      const servicesList = [
        'Management Training',
        'Employee Engagement',
        'HR Consulting',
        'Employee Assistance',
        'Outbound Training',
        'Soft Skills'
      ];

      const flagshipPrograms = [
        'Managerial Dev. Program',
        'Train The Trainer',
        'Handling Conversation',
        'Campus to Corporate',
        'Business Comm. Skills',
        'Mentoring Skills',
        'Diversity & Inclusion',
        'Sahyog'
      ];

      // Keyword responses (typed input fallback)
      function getBotResponse(message) {
        const lower = message.toLowerCase();
        if (lower.includes('contact') || lower.includes('address')) {
          return `Our office is located at ${contactInfo.address}`;
        }
        if (lower.includes('phone') || lower.includes('call') || lower.includes('contact number')) {
          return `You can reach us at ${contactInfo.phones.join(' or ')}.`;
        }
        if (lower.includes('email') || lower.includes('mail')) {
          return `For inquiries, please email us at ${contactInfo.email}`;
        }
        if (lower.includes('training') || lower.includes('program')) {
          return 'We offer various training programs including Outbound Training, SAHYOG Wellness, and POSH Certification.';
        }
        if (lower.includes('service') || lower.includes('offer')) {
          return 'We provide corporate training solutions in leadership development, team building, and mental wellness programs.';
        }
        // fallback
        return 'I’m here to help! You can click one of the options below or tell me what you need.';
      }

      // --- DOM references ---
      const toggleBtn = document.getElementById('chatbotToggle');
      const windowEl = document.getElementById('chatbotWindow');
      const closeBtn = document.getElementById('chatbotClose');
      const sendBtn = document.getElementById('chatbotSend');
      const inputEl = document.getElementById('chatbotInput');
      const bodyEl = document.getElementById('chatbotBody');
      const optionsContainer = document.getElementById('chatOptions');
      const clearBtn = document.getElementById('chatClear');

      // --- helpers ---
      function scrollChatToBottom() {
        bodyEl.scrollTop = bodyEl.scrollHeight;
      }

      function createMessage({ text, who = 'bot', html = false }) {
        const wrapper = document.createElement('div');
        wrapper.className =
          'chatbot-message ' +
          (who === 'user'
            ? 'user bg-primary text-white rounded-lg p-3 mb-3 max-w-[80%] float-right clear-both text-sm sm:text-base'
            : 'bot bg-blue-50 text-gray-800 rounded-lg p-3 mb-3 max-w-[80%] float-left clear-both text-sm sm:text-base');
        if (html) wrapper.innerHTML = text;
        else wrapper.textContent = text;
        bodyEl.appendChild(wrapper);
        scrollChatToBottom();
        return wrapper;
      }

      function createTypingIndicator() {
        return createMessage({ text: 'Typing...', who: 'bot' });
      }

      // Show quick options and prompt "How may I help you?"
      function showOptionsPrompt(delay = 500) {
        setTimeout(() => {
          createMessage({ text: 'How may I help you?', who: 'bot' });
          renderQuickOptions();
        }, delay);
      }

      // Create clickable quick options
      function renderQuickOptions() {
        optionsContainer.innerHTML = '';

        const mainOptions = [
          { label: 'Services', action: 'services' },
          { label: 'Flagship Programs', action: 'programs' },
          { label: 'Contact', action: 'contact' },
          { label: 'Phone', action: 'phone' },
          { label: 'Email', action: 'email' },
          { label: 'Events', action: 'goto', target: 'Events' },
          { label: 'Gallery', action: 'goto', target: 'Gallery' },
          { label: 'Blogs', action: 'goto', target: 'Blogs' },
          { label: 'About Us', action: 'goto', target: 'About Us' }
        ];

        mainOptions.forEach(opt => {
          const btn = document.createElement('button');
          btn.className = 'px-3 py-1 text-xs sm:text-sm rounded-full border border-gray-200 hover:bg-slate-50';
          btn.textContent = opt.label;
          btn.dataset.action = opt.action;
          if (opt.target) btn.dataset.target = opt.target;
          optionsContainer.appendChild(btn);
        });

        scrollChatToBottom();
      }

      // Show service details then show options again
      function showServiceDetails(serviceName) {
        const description = `${serviceName} — a tailored solution to address corporate needs. Click Learn more to visit the Services page.`;
        const typing = createTypingIndicator();
        setTimeout(() => {
          typing.remove();
          createMessage({ text: description, who: 'bot' });
          const html = `<div class="mt-2"><button data-action="goto" data-target="Services" class="px-3 py-1 rounded-md bg-primary text-white text-xs">Learn more</button></div>`;
          createMessage({ text: html, who: 'bot', html: true });
          // show options again
          showOptionsPrompt(700);
        }, 700);
      }

      // Show program details then show options again
      function showProgramDetails(programName) {
        const description = `${programName} — structured program designed to build competencies and measurable outcomes. Click Go to Flagship Programs to know more.`;
        const typing = createTypingIndicator();
        setTimeout(() => {
          typing.remove();
          createMessage({ text: description, who: 'bot' });
          const html = `<div class="mt-2"><button data-action="goto" data-target="Flagship Programs" class="px-3 py-1 rounded-md bg-primary text-white text-xs">Go to Flagship Programs</button></div>`;
          createMessage({ text: html, who: 'bot', html: true });
          // show options again
          showOptionsPrompt(700);
        }, 700);
      }

      // Navigate to the mapped page (same tab). If no mapping, fallback to hash navigation.
      function goToPage(name) {
        const normalized = name.trim();
        const url = pageUrlMap[normalized];
        if (url) {
          // give a small confirmation message then navigate
          createMessage({ text: `Opening ${normalized}...`, who: 'bot' });
          // navigate in same tab
          window.location.href = url;
        } else {
          // fallback: attempt scroll to element id
          const id = normalized.toLowerCase().replace(/\s+/g, '-');
          const el = document.getElementById(id);
          if (el) {
            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
            createMessage({ text: `Taking you to ${normalized} section.`, who: 'bot' });
            // show options afterwards
            showOptionsPrompt(700);
          } else {
            createMessage({ text: `Couldn't find a page or section for "${normalized}".`, who: 'bot' });
            showOptionsPrompt(600);
          }
        }
      }

      // --- main event handlers ---
      function handleOptionClick(target) {
        const action = target.dataset.action;
        const t = target.dataset.target || target.textContent;

        if (action === 'services') {
          const typing = createTypingIndicator();
          setTimeout(() => {
            typing.remove();
            createMessage({ text: 'Here are our Services:', who: 'bot' });
            const html = servicesList.map(s => `<button data-action="service" data-name="${s}" class="m-1 px-3 py-1 text-xs rounded-full border border-gray-200">${s}</button>`).join('');
            createMessage({ text: html, who: 'bot', html: true });
            // show options again under the list
            showOptionsPrompt(600);
          }, 500);
          return;
        }

        if (action === 'programs') {
          const typing = createTypingIndicator();
          setTimeout(() => {
            typing.remove();
            createMessage({ text: 'Our Flagship Programs:', who: 'bot' });
            const html = flagshipPrograms.map(p => `<button data-action="program" data-name="${p}" class="m-1 px-3 py-1 text-xs rounded-full border border-gray-200">${p}</button>`).join('');
            createMessage({ text: html, who: 'bot', html: true });
            showOptionsPrompt(600);
          }, 500);
          return;
        }

        if (action === 'contact') {
          createMessage({ text: `Address: ${contactInfo.address}`, who: 'bot' });
          createMessage({ text: `Phone: ${contactInfo.phones.join(' or ')}`, who: 'bot' });
          createMessage({ text: `Email: ${contactInfo.email}`, who: 'bot' });
          showOptionsPrompt(600);
          return;
        }

        if (action === 'phone') {
          createMessage({ text: `Phone: ${contactInfo.phones.join(' or ')}`, who: 'bot' });
          showOptionsPrompt(600);
          return;
        }

        if (action === 'email') {
          createMessage({ text: `Email: ${contactInfo.email}`, who: 'bot' });
          showOptionsPrompt(600);
          return;
        }

        if (action === 'goto') {
          // Open mapped page in same tab
          const targetLabel = target.dataset.target || target.textContent;
          goToPage(targetLabel);
          return;
        }

        if (action === 'service') {
          const name = target.dataset.name;
          showServiceDetails(name);
          return;
        }
        if (action === 'program') {
          const name = target.dataset.name;
          showProgramDetails(name);
          return;
        }

        // fallback: treat as typed content
        const typedText = target.textContent || '';
        createMessage({ text: typedText, who: 'user' });
        const response = getBotResponse(typedText);
        const typing = createTypingIndicator();
        setTimeout(() => {
          typing.remove();
          createMessage({ text: response, who: 'bot' });
          showOptionsPrompt(600);
        }, 800);
      }

      // Delegate clicks inside chat body (for dynamic buttons)
      bodyEl.addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;
        const action = btn.dataset.action;
        if (!action) return;
        // small user bubble showing clicked option
        const label = btn.textContent;
        createMessage({ text: label, who: 'user' });
        handleOptionClick(btn);
      });

      // Top-level quick options click
      optionsContainer.addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;
        handleOptionClick(btn);
      });

      // send typed message
      function sendMessage() {
        const message = inputEl.value.trim();
        if (!message) return;
        createMessage({ text: message, who: 'user' });
        inputEl.value = '';
        const typing = createTypingIndicator();
        setTimeout(() => {
          typing.remove();
          // If user typed exact name of a service or program, prefer direct show
          const normalized = message.toLowerCase();
          const serviceMatch = servicesList.find(s => normalized === s.toLowerCase());
          const progMatch = flagshipPrograms.find(p => normalized === p.toLowerCase());
          if (serviceMatch) {
            showServiceDetails(serviceMatch);
            return;
          }
          if (progMatch) {
            showProgramDetails(progMatch);
            return;
          }
          // If they typed a page name like 'services' or 'blogs', open page
          const pageKey = Object.keys(pageUrlMap).find(k => k.toLowerCase() === message.toLowerCase());
          if (pageKey) {
            goToPage(pageKey);
            return;
          }
          const response = getBotResponse(message);
          createMessage({ text: response, who: 'bot' });
          showOptionsPrompt(600);
        }, 900);
      }

      // Toggle open/close
      function toggleChatbot() {
        const isHidden = windowEl.classList.contains('hidden');
        if (isHidden) {
          windowEl.classList.remove('hidden');
          // render quick options each time to ensure fresh buttons
          renderQuickOptions();
        } else {
          windowEl.classList.add('hidden');
        }
      }

      // Clear chat
      function clearChat() {
        bodyEl.innerHTML = '';
        createMessage({ text: 'Welcome! Choose an option below or type your question. 👇', who: 'bot' });
        renderQuickOptions();
      }

      // --- wire up events ---
      toggleBtn.addEventListener('click', toggleChatbot);
      closeBtn.addEventListener('click', toggleChatbot);
      sendBtn.addEventListener('click', sendMessage);
      inputEl.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });
      clearBtn.addEventListener('click', clearChat);

    })();


    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyA8t0YBEkZ-hDHmw7u8aud-jwNybYEKnbU",
      authDomain: "psypanweb-7747a.firebaseapp.com",
      projectId: "psypanweb-7747a",
      storageBucket: "psypanweb-7747a.appspot.com",
      messagingSenderId: "441049264188",
      appId: "1:441049264188:web:4dab8de0554b2c7c741339",
      measurementId: "G-C1CTMX729Z"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    (function () {
      const container = document.getElementById('updates-carousel');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const AUTO_INTERVAL = 3000; // 3 seconds
      let updates = [];
      let idx = 0;
      let autoTimer = null;
      let isPaused = false;
      let currentSlideEl = null;
      let animating = false;

      // Simple truncate helper for Read More (30 words)
      function truncateContent(content, limit = 30) {
        if (!content) return { text: '', isTruncated: false, fullText: '' };
        const words = content.trim().split(/\s+/);
        if (words.length <= limit) return { text: content, isTruncated: false, fullText: content };
        return { text: words.slice(0, limit).join(' ') + '...', isTruncated: true, fullText: content };
      }

      // Build slide DOM for a given data object
      function buildSlide(data) {
        const slide = document.createElement('div');
        slide.className = 'update-item enter-from-right';

        // Left: image, Right: text
        const left = document.createElement('div');
        left.className = 'update-left';
        const img = document.createElement('img');
        img.className = 'update-image';
        img.alt = data.title || 'update image';
        img.src = data.image || '';

        left.appendChild(img);

        const right = document.createElement('div');
        right.className = 'update-right';

        const titleEl = document.createElement('div');
        titleEl.className = 'update-title';
        titleEl.textContent = data.title || '';

        const subtitleEl = document.createElement('div');
        subtitleEl.className = 'update-subtitle';
        subtitleEl.textContent = data.subtitle || '';

        const contentEl = document.createElement('div');
        contentEl.className = 'update-content';

        const truncated = truncateContent(data.content || '', 20);
        contentEl.textContent = truncated.text;

        if (truncated.isTruncated) {
          const btn = document.createElement('span');
          btn.className = 'read-more-btn';
          btn.textContent = ' Read More';
          btn.addEventListener('click', () => {
            if (btn.textContent.trim() === 'Read More') {
              contentEl.textContent = truncated.fullText;
              btn.textContent = ' Read Less';
            } else {
              contentEl.textContent = truncated.text;
              btn.textContent = ' Read More';
            }
            contentEl.appendChild(btn);
          });
          contentEl.appendChild(btn);
        }

        right.append(titleEl, subtitleEl, contentEl);

        slide.append(left, right);
        return { slide, parts: [titleEl, subtitleEl, contentEl, img] };
      }

      // Show slide at newIndex. direction = 'next' or 'prev'
      function showSlide(newIndex, direction = 'next') {
        if (animating) return;
        animating = true;

        const prevEl = currentSlideEl;
        const { slide, parts } = buildSlide(updates[newIndex]);

        // set initial classes based on direction
        if (direction === 'next') {
          slide.classList.remove('enter-from-left');
          slide.classList.add('enter-from-right');
        } else {
          slide.classList.remove('enter-from-right');
          slide.classList.add('enter-from-left');
        }
        // append new slide (on top)
        container.appendChild(slide);

        // force reflow then bring to center
        requestAnimationFrame(() => {
          slide.classList.add('current');
          slide.classList.remove('enter-from-right', 'enter-from-left');
          // previous exit animation
          if (prevEl) {
            if (direction === 'next') {
              prevEl.classList.add('exit-to-left');
            } else {
              prevEl.classList.add('exit-to-right');
            }
            // remove prev after transition
            prevEl.addEventListener('transitionend', function onEnd() {
              prevEl.removeEventListener('transitionend', onEnd);
              if (prevEl.parentElement) prevEl.parentElement.removeChild(prevEl);
            });
          }
        });

        // sequentially animate parts (faster pace)
        const partDelays = [180, 420, 700, 1000]; // ms offsets for title, subtitle, content, image
        parts.forEach((p, i) => {
          // ensure hidden initially
          p.style.opacity = 0;
          p.style.transform = 'translateY(12px)';
          setTimeout(() => p.classList.add('fade-in'), partDelays[i]);
        });

        // after slide animation complete, mark currentSlideEl and clear animating flag
        // allow same total time: transition duration ~600ms + parts (we'll wait 1.2s)
        setTimeout(() => {
          // cleanup classes
          slide.classList.remove('exit-to-left', 'exit-to-right');
          currentSlideEl = slide;
          animating = false;
        }, 1400);
      }

      function nextSlide(manual = false) {
        if (!updates.length) return;
        const newIndex = (idx + 1) % updates.length;
        showSlide(newIndex, 'next');
        idx = newIndex;
        if (manual) resetAuto();
      }

      function prevSlide(manual = false) {
        if (!updates.length) return;
        const newIndex = (idx - 1 + updates.length) % updates.length;
        showSlide(newIndex, 'prev');
        idx = newIndex;
        if (manual) resetAuto();
      }

      function startAuto() {
        stopAuto();
        autoTimer = setInterval(() => {
          if (!isPaused && !animating) nextSlide(false);
        }, AUTO_INTERVAL);
      }
      function stopAuto() { if (autoTimer) { clearInterval(autoTimer); autoTimer = null; } }
      function resetAuto() { stopAuto(); startAuto(); }

      // Pause on hover
      container.addEventListener('mouseenter', () => { isPaused = true; });
      container.addEventListener('mouseleave', () => { isPaused = false; });

      // arrow handlers
      prevBtn.addEventListener('click', () => prevSlide(true));
      nextBtn.addEventListener('click', () => nextSlide(true));

      // Fetch updates from Firestore (ensure firebase & firestore available)
      function fetchAndStart() {
        if (!(window.firebase && firebase.firestore)) {
          console.error('Firestore not found. Initialize Firebase before using updates carousel.');
          return;
        }
        firebase.firestore()
          .collection('current_updates')
          .orderBy('createdAt', 'asc')
          .get()
          .then(snapshot => {
            updates = [];
            snapshot.forEach(doc => {
              // ensure we have expected fields; fallback empty strings if missing
              const d = doc.data() || {};
              updates.push({
                title: d.title || '',
                subtitle: d.subtitle || '',
                content: d.content || '',
                image: d.image || ''
              });
            });
            if (!updates.length) {
              // show placeholder
              updates = [{
                title: 'No updates yet',
                subtitle: '',
                content: 'We will publish the latest news and CEO thoughts here soon.',
                image: ''
              }];
            }
            // initial show
            idx = 0;
            showSlide(idx, 'next');
            startAuto();
          })
          .catch(err => {
            console.error('Error fetching updates:', err);
          });
      }

      // wait a short while for firebase to be ready if needed
      if (window.firebase && firebase.firestore) {
        fetchAndStart();
      } else {
        // poll for up to 6s
        let waited = 0;
        const poll = setInterval(() => {
          if (window.firebase && firebase.firestore) {
            clearInterval(poll);
            fetchAndStart();
          } else {
            waited += 200;
            if (waited > 6000) {
              clearInterval(poll);
              console.error('Firebase not initialized. Carousel aborted.');
            }
          }
        }, 200);
      }
    })();

    // Counter animation function
    function animateCount(id, target, suffix = '') {
      const element = document.getElementById(id);
      let count = 0;
      const duration = 2000; // 2 seconds
      const stepTime = Math.max(Math.floor(duration / target), 20);

      const counter = setInterval(() => {
        count++;
        element.textContent = count.toLocaleString() + suffix;
        if (count >= target) {
          clearInterval(counter);
        }
      }, stepTime);
    }

    // Fetch stats from Firestore
    function fetchStats() {
      const statsRef = db.collection('numdata').doc('stats');

      statsRef.get().then((doc) => {
        if (doc.exists) {
          const data = doc.data();

          // Clean numbers: remove + , and convert to integer
          const companies = parseInt(data.companies.replace(/[+,]/g, '')) || 0;
          const experience = parseInt(data.experience.replace(/[+,]/g, '')) || 0;
          const associates = parseInt(data.associates.replace(/[+,]/g, '')) || 0;
          const participants = parseInt(data.participants.replace(/[+,]/g, '')) || 0;

          // Animate each stat
          animateCount('clients-stat', companies, '+');
          animateCount('experience-stat', experience, '+');
          animateCount('retention-stat', associates, '+');
          animateCount('trained-stat', participants, '+');
        } else {
          console.log("No such document!");
        }
      }).catch((error) => {
        console.log("Error getting document:", error);
      });
    }

    // Call function on load
    window.addEventListener('load', fetchStats);


    // Initialize logo carousel
    function initLogoCarousel() {
      const logos = document.querySelectorAll('.logo-item-carousel');
      let current = 0;

      // Rotate logos every 2 seconds
      setInterval(() => {
        // Remove active class from current logo
        logos[current].classList.remove('active');

        // Move to next logo
        current = (current + 1) % logos.length;

        // Add active class to new logo
        logos[current].classList.add('active');
      }, 2000);
    }

    // Initialize everything when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize Firebase stats
      fetchStats();

      // Initialize logo carousel
      initLogoCarousel();

      (function () {
        const cards = document.querySelectorAll('.flip-card');

        // Keyboard toggle for each card
        cards.forEach(card => {
          card.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              card.classList.toggle('is-flipped');
              const pressed = card.classList.contains('is-flipped');
              card.setAttribute('aria-pressed', pressed.toString());
            }
          });

          // Click/tap toggles flip for touch devices (and mouse clicks)
          card.addEventListener('click', (e) => {
            // allow links inside the card to work normally
            if (e.target.closest('a')) return;
            // If device supports hover, keep hover behavior; but clicks should still work
            card.classList.toggle('is-flipped');
            const pressed = card.classList.contains('is-flipped');
            card.setAttribute('aria-pressed', pressed.toString());
          });

          // When focus leaves the card, remove flipped state so keyboard users don't leave it flipped unintentionally
          card.addEventListener('focusout', (e) => {
            // small timeout to allow focus to move to internal links/buttons
            setTimeout(() => {
              if (!card.contains(document.activeElement)) {
                card.classList.remove('is-flipped');
                card.setAttribute('aria-pressed', 'false');
              }
            }, 10);
          });
        });
      })();


      // Mobile Menu Toggle
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');

      mobileMenuButton.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
      });

      // Smooth scrolling for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();

          const targetId = this.getAttribute('href');
          const targetElement = document.querySelector(targetId);

          if (targetElement) {
            window.scrollTo({
              top: targetElement.offsetTop - 80,
              behavior: 'smooth'
            });

            // Close mobile menu if open
            mobileMenu.classList.add('hidden');
          }
        });
      });

      // Scroll animations
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('active');
          }
        });
      }, {
        threshold: 0.1
      });

      document.querySelectorAll('.animate-on-scroll').forEach((el) => {
        observer.observe(el);
      });

    });

    (function () {
      // Ensure Firestore (compat) or modular is present on the page.
      if (!(window.firebase && firebase.firestore)) {
        console.error('Firebase Firestore (compat) not found. Ensure you included Firebase and initialized it on the page before this script.');
        return;
      }

      // Use existing testimonialsRef if declared; otherwise create fallback
      let testimonialsRef = (typeof window.testimonialsRef !== 'undefined') ? window.testimonialsRef : null;
      if (!testimonialsRef) {
        testimonialsRef = firebase.firestore().collection('testimonials');
      }

      // Cloudinary config (unchanged)
      const cloudName = 'dhwanw6f7';
      const uploadPreset = 'psychepan_unsigned';
      const cloudinaryUrl = `https://api.cloudinary.com/v1_1/${cloudName}/upload`;

      // DOM refs
      const photoEl = document.getElementById('testimonial-photo');
      const nameEl = document.getElementById('testimonial-name');
      const roleEl = document.getElementById('testimonial-role');
      const textEl = document.getElementById('testimonial-text');
      const starsEl = document.getElementById('testimonial-stars');
      const prevBtn = document.getElementById('prev-btn');
      const nextBtn = document.getElementById('next-btn');
      const counterEl = document.getElementById('testimonial-counter');
      const gridEl = document.getElementById('testimonials-grid');

      const addBtn = document.getElementById('addReviewBtn');
      const modal = document.getElementById('reviewModal');
      const modalClose = document.getElementById('modalClose');
      const modalCancel = document.getElementById('modalCancel');
      const reviewForm = document.getElementById('reviewForm');
      const formMsg = document.getElementById('formMsg');

      const rName = document.getElementById('r-name');
      const rRole = document.getElementById('r-role');
      const rPhoto = document.getElementById('r-photo');
      const rPhotoFile = document.getElementById('r-photo-file');
      const rRating = document.getElementById('r-rating');
      const rText = document.getElementById('r-text');

      let testimonials = []; // full set (most recent first)
      let currentIndex = 0;

      const DEFAULT_AVATAR = 'https://www.gravatar.com/avatar/?d=mp&s=160';

      // Utility: safe HTML escape
      function escapeHtml(str) {
        if (!str && str !== 0) return '';
        return String(str)
          .replaceAll('&', '&amp;')
          .replaceAll('<', '&lt;')
          .replaceAll('>', '&gt;')
          .replaceAll('"', '&quot;')
          .replaceAll("'", '&#39;');
      }

      // Render stars
      function renderStars(container, rating) {
        container.innerHTML = '';
        rating = Math.max(0, Math.min(5, parseInt(rating || 0, 10)));
        for (let i = 1; i <= 5; i++) {
          const span = document.createElement('span');
          span.className = 'text-lg mr-1';
          span.textContent = i <= rating ? '⭐' : '☆';
          container.appendChild(span);
        }
      }

      // Try to load an image URL into an <img> element with fallbacks for HEIC & Cloudinary
      // Returns a Promise that resolves to the final used URL (or DEFAULT_AVATAR)
      function tryLoadImage(url, imgEl) {
        return new Promise(resolve => {
          if (!url) {
            imgEl.src = DEFAULT_AVATAR;
            resolve(DEFAULT_AVATAR);
            return;
          }

          let triedCloudinary = false;
          let triedHeicRename = false;
          let resolved = false;

          function setDefault() {
            if (!resolved) {
              imgEl.src = DEFAULT_AVATAR;
              resolved = true;
              resolve(DEFAULT_AVATAR);
            }
          }

          // Helper to attempt a url and wire onload/onerror
          function attempt(u, onFail) {
            const testImg = new Image();
            testImg.crossOrigin = 'anonymous';
            testImg.onload = function () {
              if (!resolved) {
                imgEl.src = u;
                resolved = true;
                resolve(u);
              }
            };
            testImg.onerror = function () {
              (onFail || setDefault)();
            };
            testImg.src = u;
          }

          // First try original
          attempt(url, function () {
            // If original fails, try cloudinary auto-format if url looks like Cloudinary
            if (!triedCloudinary && /cloudinary\.com|res\.cloudinary\.com/.test(url)) {
              triedCloudinary = true;
              // insert f_auto,q_auto after /upload/ (keeps other transformations intact)
              const newUrl = url.replace('/upload/', '/upload/f_auto,q_auto/');
              attempt(newUrl, function () {
                // if still fails, try heic->jpg rename
                if (!triedHeicRename && /\.heic(?:$|\?)/i.test(url)) {
                  triedHeicRename = true;
                  const jpgUrl = url.replace(/\.heic/i, '.jpg');
                  attempt(jpgUrl, setDefault);
                } else {
                  setDefault();
                }
              });
            } else if (!triedHeicRename && /\.heic(?:$|\?)/i.test(url)) {
              // try replacing .heic -> .jpg
              triedHeicRename = true;
              const jpgUrl = url.replace(/\.heic/i, '.jpg');
              attempt(jpgUrl, setDefault);
            } else {
              setDefault();
            }
          });
        });
      }

      // Render main large testimonial card (index wraps)
      function renderMain(i) {
        if (!testimonials.length) {
          photoEl.src = DEFAULT_AVATAR;
          photoEl.alt = 'No reviews';
          nameEl.textContent = 'No reviews yet';
          roleEl.textContent = '';
          textEl.textContent = 'Be the first to add a review.';
          starsEl.innerHTML = '';
          counterEl.textContent = '0 of 0';
          return;
        }
        i = ((i % testimonials.length) + testimonials.length) % testimonials.length; // wrap
        currentIndex = i;
        const t = testimonials[i];

        // load image with fallbacks
        tryLoadImage(t.photoURL, photoEl).then(() => {
          photoEl.alt = t.name || 'Client photo';
        });

        nameEl.textContent = t.name || 'Anonymous';
        roleEl.textContent = t.role || '';
        textEl.textContent = t.text || '';
        renderStars(starsEl, t.rating || 0);
        counterEl.textContent = `${i + 1} of ${testimonials.length}`;
      }

      // Render only the latest 3 testimonials in the grid
      function renderGrid() {
        gridEl.innerHTML = '';
        const latest = testimonials.slice(0, 3); // most recent first
        latest.forEach(t => {
          const card = document.createElement('div');
          card.className = 'bg-white p-4 rounded-lg shadow-sm border border-gray-100';

          const flex = document.createElement('div');
          flex.className = 'flex items-center gap-3 mb-3';

          const img = document.createElement('img');
          img.className = 'w-12 h-12 rounded-full object-cover';
          img.alt = t.name || 'Anonymous';
          // start with a fallback; will be replaced if load succeeds
          img.src = DEFAULT_AVATAR;

          // attempt to load real image
          tryLoadImage(t.photoURL, img).catch(() => {
            img.src = DEFAULT_AVATAR;
          });

          const meta = document.createElement('div');
          const title = document.createElement('div');
          title.className = 'font-semibold text-sm';
          title.textContent = t.name || 'Anonymous';
          const sub = document.createElement('div');
          sub.className = 'text-xs text-gray-500';
          sub.textContent = t.role || '';

          meta.appendChild(title);
          meta.appendChild(sub);
          flex.appendChild(img);
          flex.appendChild(meta);

          const quote = document.createElement('div');
          quote.className = 'text-sm text-gray-700 mb-2 italic';
          quote.textContent = `"${t.text || ''}"`;

          const stars = document.createElement('div');
          stars.className = 'text-sm text-yellow-500';
          const r = Math.max(0, Math.min(5, parseInt(t.rating || 0, 10)));
          stars.textContent = '★'.repeat(r) + '☆'.repeat(5 - r);

          card.appendChild(flex);
          card.appendChild(quote);
          card.appendChild(stars);

          gridEl.appendChild(card);
        });
      }

      // Firestore live listener
      function subscribeToTestimonials() {
        try {
          testimonialsRef.orderBy('createdAt', 'desc').onSnapshot(snapshot => {
            const docs = [];
            snapshot.forEach(doc => {
              const data = doc.data();
              docs.push({
                id: doc.id,
                name: data.name || '',
                role: data.role || '',
                photoURL: data.photoURL || '',
                rating: data.rating || 0,
                text: data.text || '',
                createdAt: data.createdAt ? (data.createdAt.toMillis ? data.createdAt.toMillis() : (data.createdAt.seconds ? data.createdAt.seconds * 1000 : null)) : null
              });
            });

            testimonials = docs; // most recent first (desc)
            // render latest 3 in grid
            renderGrid();
            // adjust current index if needed
            if (!testimonials.length) {
              renderMain(0);
            } else {
              if (currentIndex >= testimonials.length) currentIndex = 0;
              renderMain(currentIndex);
            }
          }, err => {
            console.error('Error listening to testimonials:', err);
          });
        } catch (err) {
          console.error('Error subscribing to testimonials. Make sure testimonialsRef is a valid collection reference.', err);
        }
      }

      // Add testimonial (same as before)
      function addTestimonial(payload) {
        const doc = {
          name: payload.name || '',
          role: payload.role || '',
          photoURL: payload.photoURL || '',
          rating: parseInt(payload.rating || 0, 10),
          text: payload.text || '',
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        return testimonialsRef.add(doc);
      }

      // Upload to Cloudinary (unchanged)
      async function uploadImageToCloudinary(file) {
        if (!file) return null;
        const fd = new FormData();
        fd.append('upload_preset', uploadPreset);
        fd.append('file', file);
        try {
          const res = await fetch(cloudinaryUrl, { method: 'POST', body: fd });
          if (!res.ok) {
            const txt = await res.text();
            throw new Error('Cloudinary upload failed: ' + txt);
          }
          const data = await res.json();
          return data.secure_url || data.url || null;
        } catch (err) {
          console.error('Cloudinary upload error:', err);
          return null;
        }
      }

      // Modal helpers (same)
      function openModal() {
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        rName.focus();
      }
      function closeModal() {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        formMsg.classList.add('hidden');
        formMsg.textContent = '';
        reviewForm.reset();
      }

      // prev/next behavior uses full testimonials array
      prevBtn.addEventListener('click', (e) => {
        if (!testimonials.length) return;
        renderMain(currentIndex - 1);
      });
      nextBtn.addEventListener('click', (e) => {
        if (!testimonials.length) return;
        renderMain(currentIndex + 1);
      });

      // Modal open/close
      addBtn.addEventListener('click', openModal);
      modalClose.addEventListener('click', closeModal);
      modalCancel.addEventListener('click', closeModal);
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });

      // Submit handler (uploads file if given, then adds doc)
      reviewForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const payload = {
          name: (rName.value || '').trim(),
          role: (rRole.value || '').trim(),
          photoURL: (rPhoto.value || '').trim(),
          rating: parseInt(rRating.value || '5', 10),
          text: (rText.value || '').trim()
        };

        if (!payload.name || !payload.text) {
          formMsg.classList.remove('hidden');
          formMsg.classList.remove('text-green-600');
          formMsg.classList.add('text-red-600');
          formMsg.textContent = 'Please add your name and review text.';
          return;
        }

        const submitBtn = document.getElementById('modalSubmit');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';

        try {
          const file = rPhotoFile && rPhotoFile.files && rPhotoFile.files[0] ? rPhotoFile.files[0] : null;
          if (file) {
            formMsg.classList.remove('hidden');
            formMsg.classList.remove('text-red-600');
            formMsg.classList.add('text-gray-600');
            formMsg.textContent = 'Uploading image...';
            const uploadedUrl = await uploadImageToCloudinary(file);
            if (uploadedUrl) payload.photoURL = uploadedUrl;
            else {
              formMsg.classList.remove('text-gray-600');
              formMsg.classList.add('text-red-600');
              formMsg.textContent = 'Image upload failed — proceeding with provided URL (if any).';
            }
          }

          await addTestimonial(payload);

          formMsg.classList.remove('text-red-600');
          formMsg.classList.add('text-green-600');
          formMsg.classList.remove('hidden');
          formMsg.textContent = 'Thanks — your review has been submitted!';

          setTimeout(() => {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Review';
            closeModal();
          }, 900);

        } catch (err) {
          console.error('Error adding testimonial:', err);
          formMsg.classList.remove('hidden');
          formMsg.classList.remove('text-green-600');
          formMsg.classList.add('text-red-600');
          formMsg.textContent = 'Failed to submit — please try again later.';
          submitBtn.disabled = false;
          submitBtn.textContent = 'Submit Review';
        }
      });

      // Initialize
      renderMain(0);
      renderGrid();
      subscribeToTestimonials();

    })();
  </script>

</body>

</html>