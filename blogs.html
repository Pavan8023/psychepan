<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blogs - Psyche Panacea</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#0052cc',
            secondary: '#4da8ff',
            dark: '#1a1a1a',
            light: '#f8f9fa',
            accent: '#f59e0b',
            insta: '#E1306C',
            header: '#1877F2',
          },
          fontFamily: {
            sans: ['Noto Sans', 'sans-serif'],
          },
          animation: {
            'fade-in': 'fadeIn 0.3s ease-out',
            'slide': 'slide 25s linear infinite',
            'popup-fade': 'popupFadeIn 0.3s ease forwards',
            'slide-up': 'slideUp 0.3s ease forwards',
            'message-fade': 'messageFadeIn 0.3s ease',
          },
          keyframes: {
            fadeIn: {
              from: { opacity: 0 },
              to: { opacity: 1 },
            },
            slide: {
              '0%': { transform: 'translateX(100%)' },
              '100%': { transform: 'translateX(-100%)' },
            },
            popupFadeIn: {
              from: { transform: 'scale(0.95)', opacity: 0 },
              to: { transform: 'scale(1)', opacity: 1 },
            },
            slideUp: {
              from: { transform: 'translateY(20px)', opacity: 0 },
              to: { transform: 'translateY(0)', opacity: 1 },
            },
            messageFadeIn: {
              from: { opacity: 0, transform: 'translateY(10px)' },
              to: { opacity: 1, transform: 'translateY(0)' },
            },
          }
        }
      }
    }

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyA8t0YBEkZ-hDHmw7u8aud-jwNybYEKnbU",
      authDomain: "psypanweb-7747a.firebaseapp.com",
      projectId: "psypanweb-7747a",
      storageBucket: "psypanweb-7747a.appspot.com",
      messagingSenderId: "441049264188",
      appId: "1:441049264188:web:4dab8de0554b2c7c741339",
      measurementId: "G-C1CTMX729Z"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans', sans-serif;
      background-color: #fafafa;
      color: #1a1a1a;
      overflow-x: hidden;
    }

    .tab-gradient {
      background: linear-gradient(135deg, #0052cc, #4da8ff);
    }

    /* Fixed navbar solution */
    header {
      background-color: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      position: fixed;
      top: 0;
      width: 100%;
      height: 12vh;
      z-index: 1000;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    nav a {
      position: relative;
      transition: color 0.3s ease;
    }

    nav a::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -4px;
      left: 0;
      background-color: #0052cc;
      transition: width 0.3s ease;
    }

    nav a:hover::after {
      width: 100%;
    }

    /* Mobile menu quick-toggle styles (drop into your CSS) */

    #mobile-menu.hidden {
      opacity: 0;
      transform-origin: top center;
      transform: scaleY(.96) translateY(-4px);
      pointer-events: none;
      transition: opacity 120ms ease, transform 120ms ease;
      will-change: opacity, transform;
    }

    /* Visible state */
    #mobile-menu.open {
      opacity: 1;
      transform: scaleY(1) translateY(0);
      pointer-events: auto;
      transition: opacity 120ms ease, transform 120ms ease;
    }

    /* Small visual polish for the mobile panel */
    #mobile-menu {
      position: absolute;
      left: 0;
      right: 0;
      top: 20px;
      /* adjust if your header height differs */
      z-index: 1001;
      border-bottom-left-radius: 12px;
      border-bottom-right-radius: 12px;
      box-shadow: 0 10px 30px rgba(6, 11, 26, 0.12);
      overflow: hidden;
    }

    /* Keep inner links comfortable and tappable */
    #mobile-menu .px-2 {
      padding-left: 0.5rem;
      padding-right: 0.5rem;
    }

    #mobile-menu a {
      display: block;
      width: 100%;
      text-decoration: none;
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0.06);
    }

    /* Slight background and separation so it feels snappy */
    #mobile-menu {
      background: rgba(255, 255, 255, 0.98);
      border: 1px solid rgba(15, 23, 42, 0.04);
    }

    /* Responsive safety: ensure hidden on desktop by CSS if needed */
    @media (min-width: 768px) {
      #mobile-menu {
        display: none !important;
      }
    }

    /* Utility class to block body scroll while menu open */
    .body-no-scroll {
      overflow: hidden !important;
    }

    /* Instagram Style Blog Card */
    .blog-card {
      transition: all 0.3s ease;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      background: white;
      border: 1px solid #efefef;
      max-width: 400px;
      margin: 0 auto;
    }

    .blog-card:hover {
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .blog-image,
    .blog-video {
      height: 280px;
      width: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
    }

    .blog-card:hover .blog-image,
    .blog-card:hover .blog-video {
      transform: scale(1.02);
    }

    .content-preview {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .read-more-btn {
      color: #0052cc;
      font-weight: 600;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .read-more-btn:hover {
      color: #4da8ff;
    }

    .social-btn {
      transition: all 0.3s ease;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .like-btn:hover {
      background-color: rgba(255, 0, 85, 0.1);
      color: #ff0055;
    }

    .comment-btn:hover {
      background-color: rgba(0, 184, 124, 0.1);
      color: #00b87c;
    }

    .share-btn:hover {
      background-color: rgba(0, 119, 255, 0.1);
      color: #0077ff;
    }

    /* Instagram Style Modal */
    .blog-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .blog-modal.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      max-width: 900px;
      width: 90%;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transform: scale(0.95);
      transition: transform 0.3s ease;
    }

    .blog-modal.active .modal-content {
      transform: scale(1);
    }

    /* Instagram-like modal */
    .modal-header {
      display: flex;
      align-items: center;
      padding: 14px 16px;
      border-bottom: 1px solid #efefef;
      background-color: #1877F2;
      color: white;
    }

    .modal-username {
      font-weight: 600;
      margin-left: 12px;
      font-size: 14px;
      color: white;
    }

    .modal-image-container {
      position: relative;
      background: #f0f2f5;
      height: 500px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-image,
    .modal-video {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .modal-actions {
      padding: 12px 16px;
      border-bottom: 1px solid #efefef;
      background-color: #f0f2f5;
    }

    .action-icons {
      display: flex;
      gap: 16px;
    }

    .like-count {
      font-weight: 600;
      padding: 8px 16px 4px;
      font-size: 14px;
      background-color: #f0f2f5;
    }

    .modal-caption {
      padding: 0 16px 12px;
      font-size: 14px;
      background-color: #f0f2f5;
    }

    .caption-username {
      font-weight: 600;
      margin-right: 8px;
      font-size: 14px;
    }

    .post-time {
      color: #8e8e8e;
      font-size: 10px;
      letter-spacing: 0.5px;
      padding: 0 16px 12px;
      text-transform: uppercase;
      background-color: #f0f2f5;
    }

    .comment-section {
      border-top: 1px solid #efefef;
      padding: 16px;
      flex-grow: 1;
      overflow-y: auto;
      max-height: 200px;
      background-color: white;
    }

    .comment-card {
      display: flex;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .comment-user {
      font-weight: 600;
      margin-right: 8px;
    }

    .comment-input-container {
      display: flex;
      align-items: center;
      border-top: 1px solid #efefef;
      padding: 14px 16px;
      background-color: #f0f2f5;
      flex-direction: column;
    }

    .commenter-name-container {
      width: 100%;
      margin-bottom: 10px;
      display: none;
    }

    .commenter-name-container.active {
      display: flex;
      align-items: center;
    }

    .comment-input {
      flex-grow: 1;
      border: none;
      padding: 8px 12px;
      outline: none;
      font-size: 14px;
      background: white;
      border-radius: 20px;
      width: 100%;
    }

    .post-comment-btn {
      color: #1877F2;
      font-weight: 600;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 14px;
      margin-left: 10px;
      padding: 8px 16px;
    }

    .comment-input-row {
      display: flex;
      width: 100%;
    }

    /* Animation */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes slideUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .blog-item {
      animation: slideUp 0.5s ease forwards;
      opacity: 0;
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {

      .hero-section {
        padding-top: 100px;
      }

      .modal-content {
        width: 95%;
        max-height: 85vh;
      }

      .modal-image-container {
        height: 300px;
      }
    }

    @media (max-width: 640px) {
      .modal-content {
        height: 90vh;
      }
    }

    

    /* Instagram-like blog card styling */
    .blog-header {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      background-color: #1877F2;
      color: white;
    }

    .blog-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 14px;
    }

    .blog-footer {
      padding: 12px 16px;
      border-top: 1px solid #efefef;
      background-color: #f0f2f5;
    }

    .blog-actions {
      display: flex;
      gap: 16px;
      margin-bottom: 8px;
    }

    .blog-likes {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 8px;
      color: #333;
    }

    .blog-comments-count {
      color: #8e8e8e;
      font-size: 14px;
      cursor: pointer;
    }

    .blog-date {
      color: #8e8e8e;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Instagram gradient heart */
    .liked {
      color: #ed4956 !important;
    }

    /* Loading spinner */
    .loader {
      width: 48px;
      height: 48px;
      border: 5px solid #1877F2;
      border-bottom-color: transparent;
      border-radius: 50%;
      display: inline-block;
      animation: rotation 1s linear infinite;
    }

    @keyframes rotation {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .error-message {
      color: #e53e3e;
      text-align: center;
      padding: 10px;
      font-size: 14px;
    }

    .video-icon {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 5px;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    .media-container {
      position: relative;
    }

    /* Share Modal Styles */
    .share-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 3000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .share-modal.active {
      opacity: 1;
      visibility: visible;
    }

    .share-modal-content {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 400px;
      padding: 0;
      overflow: hidden;
      transform: scale(0.95);
      transition: transform 0.3s ease;
    }

    .share-modal.active .share-modal-content {
      transform: scale(1);
    }

    .share-modal-header {
      padding: 16px;
      border-bottom: 1px solid #efefef;
      text-align: center;
      font-weight: 600;
      font-size: 16px;
    }

    .share-options {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      padding: 16px;
    }

    .share-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .share-option:hover {
      background-color: #f0f2f5;
    }

    .share-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 8px;
      font-size: 20px;
      color: white;
    }

    .share-label {
      font-size: 12px;
      text-align: center;
    }

    .share-modal-footer {
      padding: 16px;
      border-top: 1px solid #efefef;
      text-align: center;
    }

    .cancel-share {
      background: none;
      border: none;
      color: #1877F2;
      font-weight: 600;
      cursor: pointer;
      padding: 8px 16px;
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header>
    <div class="flex items-center space-x-2">
      <img class="h-16 w-14" src="/images/psypan-logo-transparent.png" alt="Psyche Panacea"
        style="height: 80px; width: 80px;">
      <div class="text-2xl font-bold text-primary">Psyche Panacea</div>
    </div>
    <nav class="hidden md:flex items-center space-x-6">
      <a href="index.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Home</a>
      <a href="services.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Services</a>
      <a href="flagship-programs.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Flagship
        Programs</a>
      <a href="events.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Events</a>
      <a href="gallery.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Gallery</a>
      <a href="about-us.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">About Us</a>
      <a href="blogs.html" class="text-primary font-semibold transition-colors px-2 py-1">Blogs</a>
      <a href="contact.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Contact</a>
    </nav>

    <!-- Mobile Menu Button -->
    <div class="md:hidden flex items-center" style="height: 40px;">
      <button id="mobile-menu-button" class="text-gray-700 hover:text-primary">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-8 h-8">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </header>

  <!-- Mobile Dropdown Menu -->
  <div id="mobile-menu" class="mt-16 md:hidden bg-white shadow-lg rounded-b-lg hidden">
    <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
      <a href="index.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Home</a>
      <a href="services.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Services</a>
      <a href="flagship-programs.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Flagship
        Programs</a>
      <a href="events.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Events</a>
      <a href="gallery.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Gallery</a>
      <a href="about-us.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">About
        Us</a>
      <a href="blogs.html" class="block px-3 py-2 rounded-md text-base font-medium text-primary bg-blue-50">Blogs</a>
      <a href="contact.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Contact</a>
    </div>
  </div>

  <!-- Hero Section -->
  <section class="hero-section pt-32 pb-20 bg-gradient-to-r from-primary to-blue-600 text-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h1 class="text-4xl md:text-5xl font-bold mb-6">Psyche Panacea Blogs</h1>
      <div class="h-1 w-24 bg-white mx-auto rounded mb-8"></div>
      <p class="text-xl mb-8 text-blue-100 max-w-3xl mx-auto">
        Insights, stories, and perspectives from our team of experts
      </p>
    </div>
  </section>

  <!-- Blogs Section -->
  <section class="py-16 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-12">
        <h2 class="text-3xl font-bold text-gray-800 mb-4">Social Feed</h2>
        <p class="text-gray-600 max-w-2xl mx-auto">Discover real-time updates, highlights, and posts that showcase our
          work and impact.</p>
      </div>

      <!-- Blog Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="blogs-container">
        <!-- Blogs will be loaded here dynamically -->
        <div class="text-center py-10 col-span-full">
          <div class="inline-block mb-4">
            <span class="loader"></span>
          </div>
          <p class="text-gray-500">Loading blogs...</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Blog Modal -->
  <div class="blog-modal fixed inset-0 z-50 bg-black bg-opacity-70 flex items-center justify-center"
    style="z-index: 2000;" id="blog-modal">
    <div
      class="modal-content bg-white w-full max-w-3xl h-[90vh] md:h-[85vh] rounded-lg shadow-lg flex flex-col overflow-hidden">

      <!-- Modal Header -->
      <div class="modal-header flex items-center p-4 border-b border-gray-200 bg-gray-100">
        <div
          class="blog-avatar bg-primary text-white w-10 h-10 rounded-full flex items-center justify-center font-bold">PP
        </div>
        <div class="modal-username ml-3 font-semibold text-gray-800">psyche_panacea</div>
        <button class="ml-auto text-2xl text-gray-600 hover:text-black" id="close-modal">&times;</button>
      </div>

      <!-- Modal Media -->
      <div class="modal-image-container h-64 md:h-80 w-full">
        <img id="modal-image" src="" alt="" class="modal-image w-full h-full object-cover hidden">
        <video id="modal-video" class="modal-video w-full h-full" controls style="display: none;"></video>
      </div>

      <!-- Scrollable Body -->
      <div class="flex-1 overflow-y-auto bg-white">

        <!-- Modal Actions -->
        <div class="modal-actions px-4 py-3 border-b border-gray-200">
          <div class="action-icons flex space-x-4 items-center text-gray-600">
            <button class="like-btn social-btn" id="modal-like-btn">
              <i class="far fa-heart text-xl hover:text-red-500 transition"></i>
            </button>
            <button class="comment-btn social-btn">
              <i class="far fa-comment text-xl hover:text-blue-500 transition"></i>
            </button>
            <button class="share-btn social-btn" id="share-btn">
              <i class="fas fa-share-alt text-xl hover:text-green-500 transition"></i>
            </button>
          </div>
        </div>

        <!-- Like Count -->
        <div class="like-count px-4 py-2 font-semibold text-sm text-gray-800">
          <span id="like-count">0</span> likes
        </div>

        <!-- Caption -->
        <div class="modal-caption px-4 pb-2 text-sm text-gray-700">
          <span class="caption-username font-semibold">psyche_panacea</span>
          <span id="modal-caption"></span>
        </div>

        <!-- Post Time -->
        <div class="post-time px-4 text-xs text-gray-400 uppercase tracking-wide" id="modal-date"></div>

        <!-- Comments Section -->
        <div id="comments-container" class="comment-section px-4 py-4 space-y-4 text-sm text-gray-800">
          <!-- Sample comments (replace with dynamic ones) -->
          <div class="text-center py-6 text-gray-400" id="no-comments">
            <i class="fas fa-comment-alt text-2xl mb-2"></i>
            <p>No comments yet</p>
          </div>
        </div>
      </div>

      <!-- Comment Input (Sticky Footer) -->
      <div class="comment-input-container border-t border-gray-200 bg-white p-3">
        <!-- Commenter Name Input -->
        <div class="commenter-name-container" id="commenter-name-container">
          <input type="text" id="commenter-name" placeholder="Your Name"
            class="comment-input flex-1 px-4 py-2 border rounded-full text-sm focus:outline-none focus:ring-1 focus:ring-primary">
          <button id="save-name-btn"
            class="post-comment-btn text-primary font-semibold text-sm hover:underline ml-2">Save</button>
        </div>

        <!-- Comment Input -->
        <div class="comment-input-row">
          <input type="text" id="comment-input" placeholder="Add a comment..."
            class="comment-input flex-1 px-4 py-2 border rounded-full text-sm focus:outline-none focus:ring-1 focus:ring-primary">
          <button id="submit-comment"
            class="post-comment-btn text-primary font-semibold text-sm hover:underline">Post</button>
        </div>
      </div>

    </div>
  </div>

  <!-- Share Modal -->
  <div class="share-modal" id="share-modal">
    <div class="share-modal-content">
      <div class="share-modal-header">
        Share
      </div>
      <div class="share-options">
        <div class="share-option" id="copy-link">
          <div class="share-icon" style="background-color: #6c757d;">
            <i class="fas fa-link"></i>
          </div>
          <span class="share-label">Copy Link</span>
        </div>
        <div class="share-option" id="share-facebook">
          <div class="share-icon" style="background-color: #1877F2;">
            <i class="fab fa-facebook-f"></i>
          </div>
          <span class="share-label">Facebook</span>
        </div>
        <div class="share-option" id="share-messenger">
          <div class="share-icon" style="background-color: #0084FF;">
            <i class="fab fa-facebook-messenger"></i>
          </div>
          <span class="share-label">Messenger</span>
        </div>
        <div class="share-option" id="share-whatsapp">
          <div class="share-icon" style="background-color: #25D366;">
            <i class="fab fa-whatsapp"></i>
          </div>
          <span class="share-label">WhatsApp</span>
        </div>
        <div class="share-option" id="share-email">
          <div class="share-icon" style="background-color: #D44638;">
            <i class="fas fa-envelope"></i>
          </div>
          <span class="share-label">Email</span>
        </div>
        <div class="share-option" id="share-threads">
          <div class="share-icon" style="background-color: #000000;">
            <i class="fab fa-threads"></i>
          </div>
          <span class="share-label">Threads</span>
        </div>
      </div>
      <div class="share-modal-footer">
        <button class="cancel-share" id="cancel-share">Cancel</button>
      </div>
    </div>
  </div>

  <!-- CLIENT LOGO MARQUEE (single-row, no double-vertical logos) -->
  <section id="clients-marquee" class="clients-marquee-section" aria-label="Our clients">
    <div class="clients-marquee-wrap">
      <div class="marquee-track" aria-hidden="true"></div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
        <!-- Left half: Map -->
        <div class="w-full h-64 sm:h-80 md:h-96 rounded-xl overflow-hidden border-2 border-blue-700 shadow-lg">
          <iframe src="https://maps.google.com/maps?q=28.467519771527627,77.03697016794533&z=15&output=embed"
            width="100%" height="100%" frameborder="0" style="border:0;" allowfullscreen loading="lazy"
            class="filter grayscale hover:grayscale-0 transition-all duration-500 pointer-events-auto"
            gestureHandling="greedy">
          </iframe>
        </div>

        <!-- Right half: Content -->
        <div class="grid grid-cols-1 gap-8">
          <!-- Company Info -->
          <div>
            <div class="flex items-center mb-4">
              <div class="bg-gradient-to-r from-blue-600 to-blue-800 p-2 rounded-lg mr-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
              </div>
              <h3 class="text-xl font-bold text-blue-400">Psyche Panacea</h3>
            </div>
            <p class="text-gray-400">
              Pioneers of innovative and breakthrough methodologies in the Indian consultation arena,
              transforming organizations through strategic HR solutions.
            </p>
          </div>

          <!-- Contact Info -->
          <div>
            <h4 class="text-lg font-semibold mb-3 text-blue-400 border-b border-blue-700 pb-1">Contact Us
            </h4>
            <ul class="space-y-4 text-gray-400 text-sm">
              <li class="flex items-start">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 mt-1 text-blue-500" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <span>308/2, Old Delhi Rd, adjacent Country Inn,<br>Sector 12 A, Anamika
                  Enclave,<br>Sector 14, Gurugram, Haryana 122001</span>
              </li>
              <li class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-500" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                </svg>
                <span>09810323292, 09810323292</span>
              </li>
              <li class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-500" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
                <span>hr@psypanconsulting.com</span>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Footer Bottom -->
      <div class="border-t border-gray-800 mt-12 pt-6 text-center text-gray-500 text-sm">
        <p>© 2023 Psyche Panacea. All rights reserved. Designed by Psyche Panacea Team.</p>
      </div>
    </div>
  </footer>

  <script>
    (function () {
      const btn = document.getElementById('mobile-menu-button');
      const menu = document.getElementById('mobile-menu');

      if (!btn || !menu) return;

      // initialize aria states
      btn.setAttribute('aria-expanded', 'false');
      menu.setAttribute('aria-hidden', 'true');

      // helper to open/close
      function openMenu() {
        menu.classList.remove('hidden');
        menu.classList.add('open');
        btn.setAttribute('aria-expanded', 'true');
        menu.setAttribute('aria-hidden', 'false');
        document.documentElement.classList.add('body-no-scroll');

        // focus first link for keyboard users
        const firstLink = menu.querySelector('a, button');
        if (firstLink) firstLink.focus({ preventScroll: true });
      }

      function closeMenu() {
        menu.classList.remove('open');
        // keep hidden attribute until transition finishes for smoothness
        menu.setAttribute('aria-hidden', 'true');
        btn.setAttribute('aria-expanded', 'false');
        document.documentElement.classList.remove('body-no-scroll');

        // after transition end hide completely to remove pointer-events if .hidden used elsewhere
        const onTransEnd = () => {
          menu.classList.add('hidden');
          menu.removeEventListener('transitionend', onTransEnd);
        };
        // if no transition fire immediately
        const computed = getComputedStyle(menu);
        const dur = parseFloat(computed.transitionDuration) || 0;
        if (dur > 0) {
          menu.addEventListener('transitionend', onTransEnd);
        } else {
          onTransEnd();
        }

        // return focus to button
        btn.focus({ preventScroll: true });
      }

      // toggle handler
      btn.addEventListener('click', (e) => {
        const isOpen = menu.classList.contains('open');
        if (isOpen) closeMenu();
        else openMenu();
      });

      // close when a menu link is clicked
      menu.addEventListener('click', (e) => {
        const target = e.target.closest('a, button');
        if (!target) return;
        // small delay so native navigation begins without abrupt UI change
        setTimeout(closeMenu, 60);
      });

      // close on Escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && menu.classList.contains('open')) {
          closeMenu();
        }
      });

      // close on outside click (outside menu and outside button)
      document.addEventListener('click', (e) => {
        if (!menu.classList.contains('open')) return;
        const isInsideMenu = !!e.target.closest('#mobile-menu');
        const isOnButton = !!e.target.closest('#mobile-menu-button');
        if (!isInsideMenu && !isOnButton) closeMenu();
      });

      // ensure correct initial state if menu had no "hidden" class in markup
      if (!menu.classList.contains('hidden') && !menu.classList.contains('open')) {
        menu.classList.add('hidden');
        menu.setAttribute('aria-hidden', 'true');
      }
    })();
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const chatbotWindow = document.getElementById("chatbotWindow");
      const chatbotToggle = document.getElementById("chatbotToggle");
      const chatbotClose = document.getElementById("chatbotClose");

      // Toggle chatbot when floating button is clicked
      chatbotToggle.addEventListener("click", () => {
        chatbotWindow.classList.toggle("hidden");
      });

      // Close chatbot when "×" is clicked
      chatbotClose.addEventListener("click", () => {
        chatbotWindow.classList.add("hidden");
      });
    });

    window.addEventListener("DOMContentLoaded", function () {
      const input = document.getElementById("chatbotInput");
      const sendBtn = document.getElementById("chatbotSend");

      // Simulate typing effect
      let message = "hii";
      let i = 0;

      function typeMessage() {
        if (i < message.length) {
          input.value += message.charAt(i);
          i++;
          setTimeout(typeMessage, 150); // typing speed
        } else {
          // Click send button after typing
          setTimeout(() => {
            sendBtn.click();
          }, 500);
        }
      }

      typeMessage();
    });

    document.addEventListener('DOMContentLoaded', initSingleMarquee);

    // Firebase Firestore references
    const blogsCollection = db.collection("blogs");
    const commentsCollection = db.collection("comments");

    // DOM elements
    const blogsContainer = document.getElementById('blogs-container');
    const blogModal = document.getElementById('blog-modal');
    const closeModal = document.getElementById('close-modal');
    const modalImage = document.getElementById('modal-image');
    const modalVideo = document.getElementById('modal-video');
    const modalCaption = document.getElementById('modal-caption');
    const modalDate = document.getElementById('modal-date');
    const likeBtn = document.getElementById('modal-like-btn');
    const likeCount = document.getElementById('like-count');
    const shareBtn = document.getElementById('share-btn');
    const commentsContainer = document.getElementById('comments-container');
    const commentInput = document.getElementById('comment-input');
    const submitComment = document.getElementById('submit-comment');
    const commenterNameInput = document.getElementById('commenter-name');
    const saveNameBtn = document.getElementById('save-name-btn');
    const commenterNameContainer = document.getElementById('commenter-name-container');
    const shareModal = document.getElementById('share-modal');
    const cancelShare = document.getElementById('cancel-share');

    // Current blog ID for modal
    let currentBlogId = null;
    let currentBlogData = null;
    let currentCommenterName = localStorage.getItem('commenterName') || '';

    // Track comment timers for real-time updates
    const commentTimers = {};

    // Format relative time for comments
    function formatRelativeTime(timestamp) {
      const now = new Date();
      const diff = now - timestamp; // in milliseconds

      const seconds = Math.floor(diff / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      const days = Math.floor(hours / 24);

      if (seconds < 60) {
        return 'just now';
      } else if (minutes < 60) {
        return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
      } else if (hours < 24) {
        return `${hours} hour${hours > 1 ? 's' : ''} ago`;
      } else if (days < 30) {
        return `${days} day${days > 1 ? 's' : ''} ago`;
      } else {
        return timestamp.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      }
    }

    // Update relative time for a comment element
    function updateRelativeTime(element, timestamp) {
      element.textContent = formatRelativeTime(timestamp);
    }

    // Start a timer to update relative time for a comment
    function startRelativeTimeUpdater(element, timestamp) {
      // Clear any existing interval for this element
      if (commentTimers[element.id]) {
        clearInterval(commentTimers[element.id]);
      }

      // Update immediately
      updateRelativeTime(element, timestamp);

      // If the comment is less than 60 minutes old, update every minute
      const now = new Date();
      const diff = now - timestamp;
      if (diff < 60 * 60 * 1000) {
        commentTimers[element.id] = setInterval(() => {
          updateRelativeTime(element, timestamp);
        }, 60000); // Update every minute
      }
    }

    // Check if URL is a video
    function isVideo(url) {
      const videoExtensions = ['.mp4', '.webm', '.ogg', '.mov'];
      return videoExtensions.some(ext => url.toLowerCase().includes(ext));
    }

    // Load blogs from Firestore
    function loadBlogs() {
      blogsContainer.innerHTML = '<div class="text-center py-10 col-span-full"><div class="inline-block mb-4"><span class="loader"></span></div><p class="text-gray-500">Loading blogs...</p></div>';

      blogsCollection.orderBy("createdAt", "desc").get().then(querySnapshot => {
        blogsContainer.innerHTML = '';

        if (querySnapshot.empty) {
          blogsContainer.innerHTML = `
            <div class="text-center py-10 col-span-full">
              <div class="inline-block mb-4">
                <i class="fas fa-file-alt text-4xl text-gray-400"></i>
              </div>
              <p class="text-gray-500">No blog posts found</p>
            </div>
          `;
          return;
        }

        let delay = 0;
        querySnapshot.forEach(doc => {
          const blog = doc.data();
          const blogId = doc.id;

          // Convert Firestore timestamp to JavaScript Date
          const createdAt = blog.createdAt ? blog.createdAt.toDate() : new Date();
          const formattedDate = createdAt.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          });

          // Check if user has liked this blog in current session
          const hasLiked = sessionStorage.getItem(`liked_${blogId}`) === 'true';
          const heartIcon = hasLiked ? 'fas fa-heart text-xl liked' : 'far fa-heart text-xl';

          const blogElement = document.createElement('div');
          blogElement.className = 'blog-item blog-card bg-white';
          blogElement.style.animationDelay = `${delay}ms`;
          delay += 150;

          // Truncate content for preview
          const truncatedContent = blog.content.length > 120 ?
            blog.content.substring(0, 120) + '...' : blog.content;

          // Determine if media is image or video
          const mediaUrl = blog.image || '';
          const isVideoMedia = isVideo(mediaUrl);

          blogElement.innerHTML = `
            <div class="blog-header">
              <div class="blog-avatar">PP</div>
              <div class="modal-username">psyche_panacea</div>
            </div>
            <div class="media-container relative">
            ${isVideoMedia ?
              `<video id="blog-video-${blog.id}" 
            class="blog-video w-full" 
            poster="${blog.thumbnail || ''}" 
            autoplay muted controls controlsList="nodownload"
            style="object-fit: cover;">
      <source src="${mediaUrl}" type="video/mp4">
    </video>

    <!-- Play Icon Overlay -->
    <div id="play-icon-${blog.id}" 
         class="video-icon absolute inset-0 flex items-center justify-center bg-black/30 cursor-pointer">
      
    </div>`
              :
              `<img src="${mediaUrl}" alt="${blog.title}" class="blog-image w-full">`
            }
</div>

            <div class="blog-footer">
              <div class="blog-actions">
                <button class="like-btn social-btn" data-id="${blogId}">
                  <i class="${heartIcon}"></i>
                </button>
                <button class="comment-btn social-btn" data-id="${blogId}">
                  <i class="far fa-comment text-xl"></i>
                </button>
                <button class="share-btn social-btn" data-id="${blogId}">
                  <i class="fas fa-share-alt text-xl"></i>
                </button>
              </div>
              <div class="blog-likes">
                <span id="like-count-${blogId}">${blog.likes || 0}</span> likes
              </div>
              <div class="content-preview text-gray-800 text-sm mb-2">
                <span class="font-semibold">psyche_panacea</span> ${truncatedContent}
              </div>
              <div class="blog-comments-count" id="comment-count-${blogId}">
                View all <span>${blog.comments || 0}</span> comments
              </div>
              <div class="blog-date">
                ${formattedDate}
              </div>
            </div>
          `;

          blogsContainer.appendChild(blogElement);

          // Add event listeners to buttons
          blogElement.querySelector(`.like-btn[data-id="${blogId}"]`).addEventListener('click', () => {
            toggleLike(blogId);
          });

          blogElement.querySelector(`.comment-btn[data-id="${blogId}"]`).addEventListener('click', () => {
            openBlogModal(blogId);
          });

          blogElement.querySelector(`.share-btn[data-id="${blogId}"]`).addEventListener('click', () => {
            showShareModal(blog, blogId);
          });

          // Add play button functionality for videos
          if (isVideoMedia) {
            const videoElement = blogElement.querySelector('video');
            const playButton = blogElement.querySelector('.video-icon');

            playButton.addEventListener('click', () => {
              videoElement.play();
              playButton.style.display = 'none';
            });

            videoElement.addEventListener('pause', () => {
              playButton.style.display = 'flex';
            });
          }
        });
      }).catch(error => {
        console.error("Error loading blogs: ", error);
        blogsContainer.innerHTML = `
          <div class="text-center py-10 col-span-full">
            <div class="inline-block mb-4">
              <i class="fas fa-exclamation-triangle text-4xl text-red-500"></i>
            </div>
            <p class="text-gray-500">Error loading blogs. Please try again later.</p>
          </div>
        `;
      });
    }

    // Toggle like for a blog
    function toggleLike(blogId) {
      // Check if user has already liked in this session
      const hasLiked = sessionStorage.getItem(`liked_${blogId}`) === 'true';
      let increment = 1;

      if (hasLiked) {
        // User is unliking
        increment = -1;
        sessionStorage.setItem(`liked_${blogId}`, 'false');
      } else {
        // User is liking
        sessionStorage.setItem(`liked_${blogId}`, 'true');
      }

      const likeCountElement = document.getElementById(`like-count-${blogId}`);
      const currentCount = parseInt(likeCountElement.textContent);
      const likeButtonIcon = document.querySelector(`.like-btn[data-id="${blogId}"] i`);

      // Update UI immediately
      likeCountElement.textContent = currentCount + increment;

      if (hasLiked) {
        likeButtonIcon.className = "far fa-heart text-xl";
      } else {
        likeButtonIcon.className = "fas fa-heart text-xl liked";
      }

      // Update Firestore
      const blogRef = blogsCollection.doc(blogId);

      blogRef.update({
        likes: firebase.firestore.FieldValue.increment(increment)
      })
        .catch(error => {
          console.error("Error updating like: ", error);
          // Revert UI if update fails
          likeCountElement.textContent = currentCount;
          if (hasLiked) {
            likeButtonIcon.className = "fas fa-heart text-xl liked";
            sessionStorage.setItem(`liked_${blogId}`, 'true');
          } else {
            likeButtonIcon.className = "far fa-heart text-xl";
            sessionStorage.setItem(`liked_${blogId}`, 'false');
          }
        });

      // If modal is open for this blog, update modal UI
      if (currentBlogId === blogId) {
        const modalLikeBtn = document.getElementById('modal-like-btn');
        const modalLikeCount = document.getElementById('like-count');
        const modalCurrentCount = parseInt(modalLikeCount.textContent);

        modalLikeCount.textContent = modalCurrentCount + increment;

        if (hasLiked) {
          modalLikeBtn.innerHTML = '<i class="far fa-heart text-xl"></i>';
        } else {
          modalLikeBtn.innerHTML = '<i class="fas fa-heart text-xl liked"></i>';
        }
      }
    }

    // Open blog modal
    function openBlogModal(blogId) {
      currentBlogId = blogId;

      // Show loading state
      commentsContainer.innerHTML = '<p class="text-center text-gray-500 py-4">Loading blog...</p>';

      // Fetch blog data from Firestore
      blogsCollection.doc(blogId).get().then(doc => {
        if (!doc.exists) {
          commentsContainer.innerHTML = '<p class="text-center text-red-500 py-4">Blog not found!</p>';
          setTimeout(closeBlogModal, 2000);
          return;
        }

        const blog = doc.data();
        currentBlogData = blog;

        // Set blog data in modal
        const mediaUrl = blog.image || '';
        const isVideoMedia = isVideo(mediaUrl);

        if (isVideoMedia) {
          modalImage.style.display = 'none';
          modalVideo.style.display = 'block';
          modalVideo.src = mediaUrl;
          modalVideo.poster = blog.thumbnail || '';
          modalVideo.controls = true;
        } else {
          modalVideo.style.display = 'none';
          modalImage.style.display = 'block';
          modalImage.src = mediaUrl;
          modalImage.alt = blog.title;
        }

        modalCaption.textContent = blog.content.substring(0, 200) + (blog.content.length > 200 ? '...' : '');

        // Set formatted date
        const createdAt = blog.createdAt ? blog.createdAt.toDate() : new Date();
        const timeDiff = Date.now() - createdAt;
        const daysAgo = Math.floor(timeDiff / (1000 * 60 * 60 * 24));

        let timeText;
        if (daysAgo === 0) {
          timeText = 'TODAY';
        } else if (daysAgo === 1) {
          timeText = '1 DAY AGO';
        } else {
          timeText = `${daysAgo} DAYS AGO`;
        }

        modalDate.textContent = timeText;

        // Set like count
        likeCount.textContent = blog.likes || 0;

        // Check if user has liked this blog in current session
        const hasLiked = sessionStorage.getItem(`liked_${blogId}`) === 'true';
        if (hasLiked) {
          likeBtn.innerHTML = '<i class="fas fa-heart text-xl liked"></i>';
        } else {
          likeBtn.innerHTML = '<i class="far fa-heart text-xl"></i>';
        }

        // Load comments
        loadComments(blogId);

        // Open modal
        blogModal.classList.add('active');
        document.body.style.overflow = 'hidden';

        // Show name input if not set
        if (!currentCommenterName) {
          commenterNameContainer.classList.add('active');
        }
      }).catch(error => {
        console.error("Error loading blog: ", error);
        commentsContainer.innerHTML = '<p class="text-center text-red-500 py-4">Error loading blog!</p>';
        setTimeout(closeBlogModal, 2000);
      });
    }

    // Close blog modal
    function closeBlogModal() {
      blogModal.classList.remove('active');
      document.body.style.overflow = 'auto';

      // Clear any comment timers
      for (const timerId in commentTimers) {
        clearInterval(commentTimers[timerId]);
        delete commentTimers[timerId];
      }

      // Pause any playing video
      if (modalVideo) {
        modalVideo.pause();
      }
    }

    // Load comments for a blog
    function loadComments(blogId) {
      commentsContainer.innerHTML = '<p class="text-center text-gray-500 py-4">Loading comments...</p>';

      // Check if collection exists
      commentsCollection.get().then(() => {
        // Collection exists, load comments
        commentsCollection.where("blogId", "==", blogId)
          .get()
          .then(querySnapshot => {
            commentsContainer.innerHTML = '';

            if (querySnapshot.empty) {
              commentsContainer.innerHTML = '<p class="text-center text-gray-500 py-4">No comments yet. Be the first to comment!</p>';
              return;
            }

            // Convert to array and sort by timestamp
            const comments = [];
            querySnapshot.forEach(doc => {
              const commentData = doc.data();
              commentData.id = doc.id;
              comments.push(commentData);
            });

            // Sort by timestamp descending
            comments.sort((a, b) => {
              const aTime = a.timestamp ? a.timestamp.toDate().getTime() : 0;
              const bTime = b.timestamp ? b.timestamp.toDate().getTime() : 0;
              return bTime - aTime;
            });

            // Display sorted comments
            comments.forEach(comment => {
              const commentDate = comment.timestamp ? comment.timestamp.toDate() : new Date();

              const commentElement = document.createElement('div');
              commentElement.className = 'comment-card';
              commentElement.innerHTML = `
                <div class="flex-shrink-0 mr-3">
                  <div class="w-8 h-8 rounded-full bg-gray-200 border-2 border-white flex items-center justify-center">
                    <span class="text-xs font-bold text-gray-600">${comment.author.charAt(0).toUpperCase() || 'U'}</span>
                  </div>
                </div>
                <div class="flex-1">
                  <div class="flex justify-between items-center mb-1">
                    <span class="comment-user font-semibold">${comment.author || 'Anonymous'}</span>
                    <span class="text-xs text-gray-500" id="comment-time-${comment.id}"></span>
                  </div>
                  <p class="text-gray-800">${comment.content}</p>
                </div>
              `;

              commentsContainer.appendChild(commentElement);

              // Set and update relative time
              const timeElement = document.getElementById(`comment-time-${comment.id}`);
              if (timeElement) {
                updateRelativeTime(timeElement, commentDate);
                startRelativeTimeUpdater(timeElement, commentDate);
              }
            });
          })
          .catch(error => {
            console.error("Error loading comments: ", error);
            commentsContainer.innerHTML = '<p class="error-message">Error loading comments. Please try again later.</p>';
          });
      }).catch(() => {
        // Collection doesn't exist yet
        commentsContainer.innerHTML = '<p class="text-center text-gray-500 py-4">No comments yet. Be the first to comment!</p>';
      });
    }

    // Like a blog from modal
    function likeBlogModal() {
      if (!currentBlogId) return;

      // Check if user has already liked in this session
      const hasLiked = sessionStorage.getItem(`liked_${currentBlogId}`) === 'true';
      let increment = 1;

      if (hasLiked) {
        // User is unliking
        increment = -1;
        sessionStorage.setItem(`liked_${currentBlogId}`, 'false');
      } else {
        // User is liking
        sessionStorage.setItem(`liked_${currentBlogId}`, 'true');
      }

      const currentCount = parseInt(likeCount.textContent);
      const likeCountElement = document.getElementById(`like-count-${currentBlogId}`);
      const likeButtonIcon = document.querySelector(`.like-btn[data-id="${currentBlogId}"] i`);

      // Update UI immediately
      likeCount.textContent = currentCount + increment;

      if (hasLiked) {
        likeBtn.innerHTML = '<i class="far fa-heart text-xl"></i>';
      } else {
        likeBtn.innerHTML = '<i class="fas fa-heart text-xl liked"></i>';
      }

      if (likeCountElement) {
        likeCountElement.textContent = parseInt(likeCountElement.textContent) + increment;
      }
      if (likeButtonIcon) {
        if (hasLiked) {
          likeButtonIcon.className = "far fa-heart text-xl";
        } else {
          likeButtonIcon.className = "fas fa-heart text-xl liked";
        }
      }

      // Update Firestore
      const blogRef = blogsCollection.doc(currentBlogId);

      blogRef.update({
        likes: firebase.firestore.FieldValue.increment(increment)
      })
        .catch(error => {
          console.error("Error updating like: ", error);
          // Revert UI if update fails
          likeCount.textContent = currentCount;
          if (hasLiked) {
            likeBtn.innerHTML = '<i class="fas fa-heart text-xl liked"></i>';
            sessionStorage.setItem(`liked_${currentBlogId}`, 'true');
          } else {
            likeBtn.innerHTML = '<i class="far fa-heart text-xl"></i>';
            sessionStorage.setItem(`liked_${currentBlogId}`, 'false');
          }
          if (likeCountElement) likeCountElement.textContent = currentCount;
          if (likeButtonIcon) {
            if (hasLiked) {
              likeButtonIcon.className = "fas fa-heart text-xl liked";
            } else {
              likeButtonIcon.className = "far fa-heart text-xl";
            }
          }
        });
    }

    // Show share modal
    function showShareModal(blog, blogId) {
      currentBlogData = blog;
      currentBlogId = blogId;
      
      // Set up share options
      const shareUrl = `${window.location.origin}${window.location.pathname}?blogId=${blogId}`;
      
      // Copy link
      document.getElementById('copy-link').onclick = () => {
        navigator.clipboard.writeText(shareUrl).then(() => {
          alert('Link copied to clipboard!');
          closeShareModal();
        });
      };
      
      // Facebook
      document.getElementById('share-facebook').onclick = () => {
        window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`, '_blank');
        closeShareModal();
      };
      
      // Messenger
      document.getElementById('share-messenger').onclick = () => {
        window.open(`fb-messenger://share/?link=${encodeURIComponent(shareUrl)}`, '_blank');
        closeShareModal();
      };
      
      // WhatsApp
      document.getElementById('share-whatsapp').onclick = () => {
        window.open(`https://wa.me/?text=${encodeURIComponent(shareUrl)}`, '_blank');
        closeShareModal();
      };
      
      // Email
      document.getElementById('share-email').onclick = () => {
        window.open(`mailto:?subject=${encodeURIComponent(blog.title)}&body=${encodeURIComponent(blog.content.substring(0, 100) + '...\n\n' + shareUrl)}`, '_blank');
        closeShareModal();
      };
      
      // Threads
      document.getElementById('share-threads').onclick = () => {
        // Threads doesn't have a direct share URL, so we'll use the same as Facebook
        window.open(`https://www.threads.net/intent/post?text=${encodeURIComponent(blog.content.substring(0, 100) + '... ' + shareUrl)}`, '_blank');
        closeShareModal();
      };
      
      shareModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    // Close share modal
    function closeShareModal() {
      shareModal.classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    // Save commenter name
    function saveCommenterName() {
      const name = commenterNameInput.value.trim();
      if (name) {
        currentCommenterName = name;
        localStorage.setItem('commenterName', name);
        commenterNameContainer.classList.remove('active');
      }
    }

    // Add a comment
    function addComment() {
      if (!currentBlogId) return;

      const content = commentInput.value.trim();

      if (!content) {
        alert('Please enter a comment');
        return;
      }

      // Use saved name or "Anonymous" if not set
      const author = currentCommenterName || 'Anonymous';

      // Add comment to Firestore
      commentsCollection.add({
        blogId: currentBlogId,
        content: content,
        author: author,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      })
        .then((docRef) => {
          // Update blog comment count
          const blogRef = blogsCollection.doc(currentBlogId);
          blogRef.update({
            comments: firebase.firestore.FieldValue.increment(1)
          })
            .then(() => {
              // Update comment count in modal and on blog card
              const commentCountElement = document.getElementById(`comment-count-${currentBlogId}`);
              if (commentCountElement) {
                const currentCount = parseInt(commentCountElement.querySelector('span').textContent);
                commentCountElement.querySelector('span').textContent = currentCount + 1;
              }

              // Add the new comment to the UI immediately
              const commentElement = document.createElement('div');
              commentElement.className = 'comment-card';
              const commentId = `comment-${Date.now()}`;
              commentElement.innerHTML = `
                <div class="flex-shrink-0 mr-3">
                  <div class="w-8 h-8 rounded-full bg-gray-200 border-2 border-white flex items-center justify-center">
                    <span class="text-xs font-bold text-gray-600">${author.charAt(0).toUpperCase() || 'U'}</span>
                  </div>
                </div>
                <div class="flex-1">
                  <div class="flex justify-between items-center mb-1">
                    <span class="comment-user font-semibold">${author}</span>
                    <span class="text-xs text-gray-500" id="${commentId}-time"></span>
                  </div>
                  <p class="text-gray-800">${content}</p>
                </div>
              `;

              // If the "no comments" message is present, remove it
              if (commentsContainer.querySelector('.text-center')) {
                commentsContainer.innerHTML = '';
              }

              // Add the new comment at the top
              commentsContainer.insertBefore(commentElement, commentsContainer.firstChild);

              // Set and update relative time for new comment
              const commentDate = new Date();
              const timeElement = document.getElementById(`${commentId}-time`);
              if (timeElement) {
                updateRelativeTime(timeElement, commentDate);
                startRelativeTimeUpdater(timeElement, commentDate);
              }

              // Clear input
              commentInput.value = '';
            });
        })
        .catch(error => {
          console.error("Error adding comment: ", error);
          alert('Error adding comment. Please try again.');
        });
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', () => {
      // Load blogs
      loadBlogs();

      // Event listeners
      closeModal.addEventListener('click', closeBlogModal);
      likeBtn.addEventListener('click', likeBlogModal);

      shareBtn.addEventListener('click', () => {
        if (currentBlogData) {
          showShareModal(currentBlogData, currentBlogId);
        }
      });

      cancelShare.addEventListener('click', closeShareModal);

      // Close share modal when clicking outside
      shareModal.addEventListener('click', (e) => {
        if (e.target === shareModal) {
          closeShareModal();
        }
      });

      submitComment.addEventListener('click', addComment);
      saveNameBtn.addEventListener('click', saveCommenterName);

      // Press Enter to submit comment
      commentInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          addComment();
        }
      });

      // Press Enter to save name
      commenterNameInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          saveCommenterName();
        }
      });

      // Show name input when comment input is focused and name not set
      commentInput.addEventListener('focus', () => {
        if (!currentCommenterName) {
          commenterNameContainer.classList.add('active');
        }
      });

      // Close modal when clicking outside
      blogModal.addEventListener('click', (e) => {
        if (e.target === blogModal) {
          closeBlogModal();
        }
      });

      // Check for blogId in URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const blogIdFromUrl = urlParams.get('blogId');
      if (blogIdFromUrl) {
        // Wait for blogs to load, then open the modal
        setTimeout(() => {
          openBlogModal(blogIdFromUrl);
        }, 1000);
      }
    });
  </script>
</body>

</html>